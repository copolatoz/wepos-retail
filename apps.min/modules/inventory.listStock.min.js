/**
 * Filename: inventory.listStock.js
 * Generated 2019-04-19 at 09:56:04 AM
 */
Ext.define('ExtApp.modules.master_pos.model.model_masterStoreHouse',{extend:'Ext.data.Model',alias:'model_masterStoreHouse',fields:[{name:'id',type:'int'},{name:'storehouse_code',type:'string'},{name:'storehouse_name',type:'string'},{name:'storehouse_desc',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'},{name:'is_primary',type:'int'},{name:'is_primary_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterStoreHouse/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.model.model_itemCategory',{extend:'Ext.data.Model',alias:'model_itemCategory',fields:[{name:'id',type:'int'},{name:'item_category_name',type:'string'},{name:'item_category_code',type:'string'},{name:'item_category_desc',type:'string'},{name:'item_category_code_name',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/itemCategory/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.inventory.model.model_listStock',{extend:'Ext.data.Model',alias:'model_listStock',fields:[{name:'id',type:'int'},{name:'tanggal',type:'string'},{name:'generate_status',type:'int'},{name:'generate_status_text',type:'string'},{name:'closing_status',type:'int'},{name:'closing_status_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'inventory/listStock/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.inventory.model.model_listStockDetail',{extend:'Ext.data.Model',alias:'model_listStockDetail',fields:[{name:'id',type:'string'},{name:'storehouse_id',type:'string'},{name:'item_id',type:'string'},{name:'item_code',type:'string'},{name:'item_name',type:'string'},{name:'total_stock_kemarin',type:'string'},{name:'total_stock_in',type:'string'},{name:'total_stock_out',type:'string'},{name:'total_stock',type:'string'},{name:'item_hpp',type:'string'},{name:'item_hpp_show',type:'string'},{name:'sales_price',type:'string'},{name:'sales_price_show',type:'string'},{name:'unit_id',type:'string'},{name:'unit_name',type:'string'},{name:'use_for_sales',type:'string'}],proxy:{type:'ajax',url:appUrl+'inventory/listStock/gridDataDetail',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.store.store_masterStoreHouse',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterStoreHouse',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_itemCategory',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_itemCategory',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.inventory.store.store_listStock',{extend:'Ext.data.Store',model:'ExtApp.modules.inventory.model.model_listStock',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.inventory.store.store_listStockDetail',{extend:'Ext.data.Store',model:'ExtApp.modules.inventory.model.model_listStockDetail',autoLoad:false,remoteSort:true});Ext.define("ExtApp.modules.inventory.view.listStock",{openWindow:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var store_listStock_grid=theApp.getStore('store_listStock_grid',false);if(store_listStock_grid==false){store_listStock_grid=theApp.copyStore('inventory','store_listStock','store_listStock_grid');}
store_listStock_grid.proxy.extraParams.limit=999999;var store_listStockDetail_grid=theApp.getStore('store_listStockDetail_grid',false);if(store_listStockDetail_grid==false){store_listStockDetail_grid=theApp.copyStore('inventory','store_listStockDetail','store_listStockDetail_grid');}
store_listStockDetail_grid.proxy.extraParams.limit=999999;store_listStockDetail_grid.proxy.extraParams.closing_date='';store_listStockDetail_grid.proxy.extraParams.storehouse_id=0;store_listStockDetail_grid.proxy.extraParams.keywords='';store_listStockDetail_grid.proxy.extraParams.category_id=-1;var store_storeHouse_listStock=theApp.getStore('store_storeHouse_listStock',false);if(store_storeHouse_listStock==false){store_storeHouse_listStock=theApp.copyStore('master_pos','store_masterStoreHouse','store_storeHouse_listStock');}
store_storeHouse_listStock.proxy.extraParams.limit=999999;store_storeHouse_listStock.proxy.extraParams.is_dropdown=1;store_storeHouse_listStock.proxy.extraParams.except_primary=0;store_storeHouse_listStock.proxy.extraParams.is_active=1;store_storeHouse_listStock.proxy.extraParams.show_all_text=0;store_storeHouse_listStock.proxy.extraParams.show_choose_text=1;store_storeHouse_listStock.proxy.extraParams.keywords='';var store_itemCategory_listStock=theApp.getStore('store_itemCategory_listStock',false);if(store_itemCategory_listStock==false){store_itemCategory_listStock=theApp.copyStore('master_pos','store_itemCategory','store_itemCategory_listStock');}
store_itemCategory_listStock.proxy.extraParams.limit=9999999;store_itemCategory_listStock.proxy.extraParams.show_all_text=1;store_itemCategory_listStock.proxy.extraParams.show_choose_text=1;store_itemCategory_listStock.proxy.extraParams.is_dropdown=1;store_itemCategory_listStock.proxy.extraParams.keywords='';var helperGrid=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');var selModel_listStock=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('generateButton_listStock').setDisabled(selections.length==0);}}});return desktop.createWindow({id:me.id,title:'List Stock',width:910,height:500,iconCls:'icon-grid',animCollapse:false,constrainHeader:true,resizable:true,maximized:false,border:false,border:0,layout:{type:'fit'},items:[{xtype:'panel',border:0,layout:{type:'border'},items:[{title:'Tanggal Stok',xtype:'gridpanel',flex:2,margins:'0 5 0 0',region:'west',store:store_listStock_grid,id:'grid_listStock',scroll:true,selModel:selModel_listStock,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'generate_status',text:'generate_status',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'closing_status',text:'closing_status',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'tanggal',text:'Date',width:100,sortable:false},{xtype:'gridcolumn',dataIndex:'closing_status_text',text:'Closing Inventory',width:130,align:'center',sortable:false}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){var getSelection=Ext.getCmp('grid_listStock').getSelectionModel().selected;if(getSelection.length>0){var getListSock_storehouse_id=Ext.getCmp('storehouse_id_listStock').getValue();Ext.getCmp('keywords_filterlistStock').getValue('');Ext.getCmp('category_id_filterlistStock').getValue(-1);store_listStockDetail_grid.proxy.extraParams.closing_date=rec.data.tanggal;store_listStockDetail_grid.proxy.extraParams.storehouse_id=getListSock_storehouse_id;store_listStockDetail_grid.proxy.extraParams.keywords='';store_listStockDetail_grid.proxy.extraParams.category_id=-1;store_listStockDetail_grid.load({callback:function(records,operation,success){var alert_hpp_vs_price=0;for(x in records){if(parseFloat(records[x]['data']['sales_price'])<parseFloat(records[x]['data']['item_hpp'])&&parseFloat(records[x]['data']['use_for_sales'])==1){alert_hpp_vs_price++;}}
if(alert_hpp_vs_price>0){ExtApp.Msg.warning('Harga Jual < Harga Hpp Terjadi di '+alert_hpp_vs_price+' Item');}}});Ext.getCmp('grid_listStockDetail').setTitle('List Stock Detail: '+rec.data.tanggal);}}},tbar:[{text:'Generate/Fix Stock',id:'generateButton_listStock',tooltip:'Generate Data Inventory',iconCls:'btn-refresh',listeners:{click:function(){var getSelection=Ext.getCmp('grid_listStock').getSelectionModel().selected;if(getSelection.length>0){me.closing_data=getSelection.items[0].data;me.generateConfirm_listStock();}else{ExtApp.Msg.info('Please Select Date!');}}}},'->']},{title:'List Stock Detail',xtype:'gridpanel',flex:5,margins:'0 0 0 0',region:'center',store:store_listStockDetail_grid,id:'grid_listStockDetail',scroll:true,columns:[{xtype:'gridcolumn',dataIndex:'item_code',text:'Item Code',width:120,sortable:false},{xtype:'gridcolumn',dataIndex:'item_name',text:'Item Name',width:150,sortable:false},{xtype:'gridcolumn',dataIndex:'total_stock_kemarin',text:'Awal',width:70,sortable:false},{xtype:'gridcolumn',dataIndex:'total_stock_in',text:'In',width:70,sortable:false},{xtype:'gridcolumn',dataIndex:'total_stock_out',text:'Out',width:70,sortable:false},{xtype:'gridcolumn',dataIndex:'total_stock',text:'Akhir',width:70,sortable:false},{xtype:'gridcolumn',dataIndex:'item_hpp_show',text:'HPP',width:100,sortable:false},{xtype:'gridcolumn',dataIndex:'sales_price_show',text:'Hrg.Jual',width:100,sortable:false}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){}},tbar:[{xtype:'combobox',name:'category_id_filterlistStock',id:'category_id_filterlistStock',fieldLabel:'Filter',emptyText:'Semua',labelWidth:40,width:250,store:store_itemCategory_listStock,displayField:'item_category_code_name',valueField:'id',queryMode:'local',listeners:{select:function(combo,records,eOpts){me.search_filterlistStock();}}},{xtype:'textfield',id:'keywords_filterlistStock',fieldLabel:'',emptyText:'Cari: Nama Item / Kode Item',labelWidth:0,width:200,listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){me.search_filterlistStock();}}}},{xtype:'button',text:'Cari',id:'searchButton_filterlistStock',tooltip:'Cari Item',iconCls:'btn-search',handler:function(){me.search_filterlistStock();}},{xtype:'button',text:'Bersihkan',id:'clearButton_filterlistStock',tooltip:'Bersihkan Pencarian',iconCls:'btn-reset',handler:function(){Ext.getCmp('keywords_filterlistStock').setValue('');Ext.getCmp('category_id_filterlistStock').setValue(-1);me.search_filterlistStock();}}]}],dockedItems:[{xtype:'toolbar',dock:'top',items:[{xtype:'datefield',id:'dateFrom_listStock',fieldLabel:'Date From',name:'date_from',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 0',labelWidth:65,width:180,value:phpJs.date('01-m-Y'),allowBlank:false},{xtype:'datefield',id:'dateTill_listStock',fieldLabel:' To ',name:'date_till',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 10',labelWidth:20,width:135,value:phpJs.date('t-m-Y'),allowBlank:false},'',{xtype:'combobox',name:'storehouse_id',id:'storehouse_id_listStock',fieldLabel:'',emptyText:'Pilih Gudang',labelWidth:90,width:200,store:store_storeHouse_listStock,displayField:'storehouse_name',valueField:'id',queryMode:'local',allowBlank:false,listeners:{select:function(combo,records,eOpts){}}},{xtype:'button',text:'Cek Stock',id:'searchButton_listStock',tooltip:'Cek Stock',iconCls:'btn-search',handler:function(){me.search_listStock();}},{xtype:'button',text:'Reset',id:'resetButton_listStock',tooltip:'Reset',iconCls:'btn-reset',handler:function(){Ext.getCmp('dateFrom_listStock').setValue(phpJs.date('01-m-Y'));Ext.getCmp('dateTill_listStock').setValue(phpJs.date('t-m-Y'));me.search_listStock();}},'->',]}]}],listeners:{boxready:function(){me.search_listStock();},show:function(){store_storeHouse_listStock.load();store_itemCategory_listStock.load();Ext.getCmp('generateButton_listStock').setDisabled(1);}}});}});