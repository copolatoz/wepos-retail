/**
 * Filename: inventory.stockOpname.js
 * Generated 2018-09-04 at 08:57:30 PM
 */
Ext.define('ExtApp.modules.master_pos.model.model_masterItemDistribution',{extend:'Ext.data.Model',alias:'model_masterItemDistribution',fields:[{name:'id',type:'int'},{name:'item_code',type:'string'},{name:'item_name',type:'string'},{name:'item_code_name',type:'string'},{name:'sales_price',type:'string'},{name:'sales_price_show',type:'string'},{name:'item_price',type:'string'},{name:'item_price_show',type:'string'},{name:'item_hpp',type:'string'},{name:'item_hpp_show',type:'string'},{name:'unit_id',type:'int'},{name:'unit_name',type:'string'},{name:'last_in_item',type:'string'},{name:'use_stok_kode_unik',type:'int'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterItem/gridDataDistribution',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.model.model_masterUnit',{extend:'Ext.data.Model',alias:'model_masterUnit',fields:[{name:'id',type:'int'},{name:'unit_name',type:'string'},{name:'unit_code',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterUnit/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.model.model_masterStoreHouse',{extend:'Ext.data.Model',alias:'model_masterStoreHouse',fields:[{name:'id',type:'int'},{name:'storehouse_code',type:'string'},{name:'storehouse_name',type:'string'},{name:'storehouse_desc',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'},{name:'is_primary',type:'int'},{name:'is_primary_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterStoreHouse/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.inventory.model.model_stockOpname',{extend:'Ext.data.Model',alias:'model_stockOpname',fields:[{name:'id',type:'int'},{name:'sto_number',type:'string'},{name:'sto_date',type:'string'},{name:'storehouse_id',type:'int'},{name:'storehouse_id_old',type:'int'},{name:'sto_status_old',type:'string'},{name:'sto_status',type:'string'},{name:'sto_status_text',type:'string'},{name:'sto_memo',type:'string'},{name:'createdby',type:'string'},{name:'is_active',type:'string'},{name:'is_active_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'inventory/stockOpname/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.inventory.model.model_stockOpnameDetail',{extend:'Ext.data.Model',alias:'model_stockOpnameDetail',fields:[{name:'id',type:'int'},{name:'sto_id',type:'int'},{name:'sto_number',type:'string'},{name:'jumlah_awal',type:'string'},{name:'jumlah_fisik',type:'string'},{name:'selisih',type:'string'},{name:'description',type:'string'},{name:'item_id',type:'int'},{name:'item_name',type:'string'},{name:'item_code',type:'string'},{name:'item_code_name',type:'string'},{name:'item_price',type:'string'},{name:'item_hpp',type:'string'},{name:'unit_id',type:'string'},{name:'unit_name',type:'string'},{name:'total_hpp_fifo',type:'string'},{name:'current_hpp_avg',type:'string'},{name:'current_hpp_avg_show',type:'string'},{name:'total_hpp_avg',type:'string'},{name:'total_hpp_avg_show',type:'string'},{name:'last_in',type:'string'},{name:'last_in_show',type:'string'},{name:'total_last_in',type:'string'},{name:'total_last_in_show',type:'string'}],proxy:{type:'ajax',url:appUrl+'inventory/stockOpname/gridDataDetail',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.store.store_masterItemDistribution',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterItemDistribution',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_masterUnit',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterUnit',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_masterStoreHouse',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterStoreHouse',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.inventory.store.store_stockOpname',{extend:'Ext.data.Store',model:'ExtApp.modules.inventory.model.model_stockOpname',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.inventory.store.store_stockOpnameDetail',{extend:'Ext.data.Store',model:'ExtApp.modules.inventory.model.model_stockOpnameDetail',autoLoad:false,remoteSort:true});Ext.define("ExtApp.modules.inventory.view.stockOpname",{openWindow:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var store_stockOpname_grid=theApp.getStore('store_stockOpname_grid',false);if(store_stockOpname_grid==false){store_stockOpname_grid=theApp.copyStore('inventory','store_stockOpname','store_stockOpname_grid');}
var helperGrid=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');var selModel_stockOpname=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_stockOpname').down('#deleteButton_stockOpname').setDisabled(selections.length==0);}}});return desktop.createWindow({id:me.id,title:'Stock Opname',width:850,height:500,iconCls:'icon-grid',animCollapse:false,constrainHeader:true,resizable:true,maximized:false,border:false,border:0,layout:{type:'border'},items:[{xtype:'form',title:'Filter',width:330,region:'west',id:'form_filter_stockOpname',split:true,collapsible:true,splitterResize:false,collapseMode:'mini',animCollapse:true,scroll:false,bodyPadding:10,margin:'0 0 0 0',items:[{xtype:'textfield',name:'keywords',labelWidth:60,labelSeparator:'',emptyText:'Keywords: Stock.No / Description',anchor:'100%',margin:'0 0 15 0',listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){me.search_stockOpname();}}}},{xtype:'panel',border:0,layout:{type:'column'},margin:'0 0 15 0',items:[{xtype:'datefield',fieldLabel:'Date From',name:'date_from',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 0',labelWidth:65,width:170,value:phpJs.date('01-01-Y'),allowBlank:false},{xtype:'datefield',fieldLabel:' To ',name:'date_till',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 10',labelWidth:20,width:125,value:phpJs.date('31-12-Y'),allowBlank:false}]},{xtype:'container',style:'text-align:right',border:0,items:[{xtype:'button',text:'Search',scale:'medium',margin:'15 0 0 0',itemId:'btnFilterSearch_stockOpname',tooltip:'Search',iconCls:'btn-search',handler:function(){me.search_stockOpname();}},{xtype:'button',text:'Reset',scale:'medium',margin:'15 60 0 10',itemId:'btnFilterReset_stockOpname',tooltip:'Reset',iconCls:'btn-reset',handler:function(){var form=Ext.getCmp('form_filter_stockOpname').getForm();form.reset();form.findField('keywords').setValue('');form.findField('date_from').setValue(phpJs.date('01-01-Y'));form.findField('date_till').setValue(phpJs.date('31-12-Y'));me.search_stockOpname();}}]}]},{xtype:'gridpanel',margins:'0 0 0 0',region:'center',store:store_stockOpname_grid,id:'grid_stockOpname',scroll:true,selModel:selModel_stockOpname,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'sto_number',text:'STO.NO',width:100},{xtype:'datecolumn',dataIndex:'sto_date',text:'Date',width:90,format:'d/m/Y'},{xtype:'gridcolumn',dataIndex:'sto_memo',text:'Description',width:350},{xtype:'gridcolumn',dataIndex:'sto_status_text',text:'Status',width:100},{xtype:'gridcolumn',dataIndex:'createdby',text:'User Input',width:120}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){var getSelection=Ext.getCmp('grid_stockOpname').getSelectionModel().selected;if(getSelection.length>0){me.formType='edit';me.edit_data=rec.data;me.createWindow(me,'add_stockOpname');}}},bbar:helperGrid.paging({ds:store_stockOpname_grid,title:'Stock Opname'}),dockedItems:[{xtype:'toolbar',dock:'top',items:[{text:'Filter',itemId:'filterButton_stockOpname',tooltip:'Filter Stock Opname',iconCls:'btn-search',listeners:{click:function(){Ext.getCmp('form_filter_stockOpname').toggleCollapse();}}},'->',{text:'Add',itemId:'addButton_stockOpname',tooltip:'Add Stock Opname',iconCls:'btn-add',handler:function(){me.formType='add';me.edit_data=[];me.createWindow(me,'add_stockOpname');}},{text:'Delete',itemId:'deleteButton_stockOpname',tooltip:'Delete Stock Opname',iconCls:'btn-delete',disabled:true,handler:function(){var getSelection=Ext.getCmp('grid_stockOpname').getSelectionModel().selected;if(getSelection.length>0){me.delete_data=getSelection.items[0].data;me.deleteConfirm_stockOpname();}else{ExtApp.Msg.info('Please Select Stock Opname!');}}},'-',{text:'Refresh',itemId:'refreshButton_stockOpname',tooltip:'Refresh Stock Opname',iconCls:'btn-refresh',handler:function(){Ext.getCmp('grid_stockOpname').store.load();}}]}]}],listeners:{boxready:function(){Ext.getCmp('form_filter_stockOpname').toggleCollapse();me.search_stockOpname();},show:function(){}}});},add_stockOpname:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Add New Stock Opname';if(me.formType=='edit'){Titletext='Update Stock Opname';}
me.store_stockOpnameDetail=theApp.getStore('inventory.store_stockOpnameDetail',false);me.store_stockOpnameDetailTemp=theApp.copyStore('inventory','store_stockOpnameDetail','store_stockOpnameDetailTemp');me.store_stockOpnameDetailTemp.proxy.extraParams.limit=999999;var store_ComboboxMasterStoreHouse_sto=theApp.getStore('store_ComboboxMasterStoreHouse_sto',false);if(store_ComboboxMasterStoreHouse_sto==false){store_ComboboxMasterStoreHouse_sto=theApp.copyStore('master_pos','store_masterStoreHouse','store_ComboboxMasterStoreHouse_sto');}
store_ComboboxMasterStoreHouse_sto.proxy.extraParams.limit=999999;store_ComboboxMasterStoreHouse_sto.proxy.extraParams.is_dropdown=1;store_ComboboxMasterStoreHouse_sto.proxy.extraParams.except_primary=1;store_ComboboxMasterStoreHouse_sto.proxy.extraParams.show_all_text=0;store_ComboboxMasterStoreHouse_sto.proxy.extraParams.show_choose_text=1;var helperGridDetail=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');var selModel_stockOpnameDetail=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_stockOpnameDetail').down('#deleteButton_stockOpnameDetail').setDisabled(selections.length==0);}}});var add_parameter='_dc='+phpJs.mktime();add_parameter+='&do=0';add_parameter+='&storehouse_id=0';var url_report=appUrl+'inventory/stockOpname/downloadStockOpname?'+add_parameter;return desktop.createWindow({id:me.id+'_add_stockOpname',title:Titletext,width:800,height:550,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:true,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'panel',height:545,title:'',bodyPadding:5,items:[{xtype:'form',id:'form_stockOpname',border:0,bodyPadding:10,border:true,margin:'0 0 0 0',items:[{xtype:'hidden',name:'form_type_stockOpname',value:me.formType},{xtype:'hidden',name:'id'},{xtype:'fieldcontainer',layout:{type:'column'},fieldLabel:'',items:[{xtype:'textfield',name:'sto_number',fieldLabel:'STO Number',labelWidth:90,width:250,disabled:true,value:'auto',allowBlank:false},{xtype:'datefield',name:'sto_date',id:'sto_date_stockOpname',margin:'3 5 0 250',labelWidth:50,width:200,fieldLabel:'Date',format:'d-m-Y',submitFormat:'Y-m-d',allowBlank:false}]},{xtype:'hidden',name:'storehouse_id_old'},{xtype:'hidden',name:'storehouse_id',id:'storehouse_id_stockOpname'},{xtype:'fieldcontainer',layout:{type:'column'},fieldLabel:'',items:[{xtype:'combobox',name:'storehouse_id_name',id:'storehouse_id_name_sto',fieldLabel:'Warehouse',emptyText:'Pilih Gudang',labelWidth:90,width:350,store:store_ComboboxMasterStoreHouse_sto,displayField:'storehouse_name',valueField:'id',queryMode:'local',allowBlank:false,listeners:{select:function(combo,records,eOpts){var form2=Ext.getCmp('form_stockOpname').getForm();form2.findField('storehouse_id').setValue(records[0].data.id);form2.findField('storehouse_id_name').setValue(records[0].data.storehouse_name);}}}]},{xtype:'textfield',name:'sto_memo',fieldLabel:'Memo',labelWidth:90,width:690,allowBlank:true},{xtype:'hidden',name:'sto_status_old'},{xtype:'radiogroup',fieldLabel:'Status',labelWidth:90,width:370,items:[{xtype:'radiofield',boxLabel:'Progress',name:'sto_status',inputValue:'progress',id:'sto_progress'},{xtype:'radiofield',boxLabel:'Done',name:'sto_status',inputValue:'done',id:'sto_done'}]}]},{xtype:'gridpanel',height:325,store:me.store_stockOpnameDetailTemp,id:'grid_stockOpnameDetail',selModel:selModel_stockOpnameDetail,scroll:true,border:1,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'Detail ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'sto_id',text:'STO ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'sto_number',text:'STO No',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_id',text:'Item ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'unit_id',text:'Unit ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_price',text:'Price',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_hpp',text:'HPP',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'last_in',text:'Last In',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_code_name',hidden:true,hideable:false},{xtype:'gridcolumn',width:130,dataIndex:'item_code',text:'Kode',sortable:false},{xtype:'gridcolumn',width:150,dataIndex:'item_name',text:'Nama Barang',sortable:false},{xtype:'gridcolumn',width:120,dataIndex:'unit_name',text:'Unit',sortable:false},{xtype:'gridcolumn',width:100,dataIndex:'jumlah_awal',text:'Qty Awal',sortable:false},{xtype:'gridcolumn',width:100,dataIndex:'jumlah_fisik',text:'Qty Fisik',sortable:false},{xtype:'gridcolumn',width:120,dataIndex:'last_in_show',text:'Last In',align:'right',sortable:false},{xtype:'gridcolumn',width:120,dataIndex:'total_last_in_show',text:'Total (Last In)',align:'right',sortable:false},{xtype:'gridcolumn',width:120,dataIndex:'current_hpp_avg_show',text:'Average',align:'right',sortable:false,hideable:false},{xtype:'gridcolumn',width:120,dataIndex:'total_hpp_avg_show',text:'Total (Average)',align:'right',sortable:false,hideable:false},{xtype:'gridcolumn',width:200,dataIndex:'description',text:'Notes',sortable:false}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){var form=Ext.getCmp('form_stockOpname').getForm();if(form.findField('form_type_stockOpname').getValue()=='edit'){if(form.findField('sto_status_old').getValue()=='done'){ExtApp.Msg.info('Cannot Update Item, Status Stock Opname is Done!');return false;}
if(form.findField('storehouse_id').getValue()==''){ExtApp.Msg.info('Please Select Warehouse!');return false;}}
var getSelection=Ext.getCmp('grid_stockOpnameDetail').getSelectionModel().selected;if(getSelection.length>0){me.formType_Detail='edit';me.edit_data=rec.data;me.createWindow(me,'add_stockOpnameDetail');}}},dockedItems:[{xtype:'toolbar',dock:'top',items:['->',{text:'Download Last Stock',id:'downloadButton_stockOpnameDetail',tooltip:'Download Data Last Stock',iconCls:'icon-download',handler:function(){me.download_stockOpnameDetail();}},'-',{text:'Upload Stock Opname',id:'uploadButton_stockOpnameDetail',tooltip:'Upload Data Stock Opname',iconCls:'btn-add',handler:function(){me.formType='add';me.createWindow(me,'upload_stockOpnameDetail');}},'-',{text:'Delete',id:'deleteButton_stockOpnameDetail',tooltip:'Delete Stock Opname Detail',iconCls:'btn-delete',disabled:true,handler:function(){var getSelection=Ext.getCmp('grid_stockOpnameDetail').getSelectionModel().selected;if(getSelection.length>0){me.delete_data=getSelection.items[0].data;me.deleteConfirm_stockOpnameDetail();}else{ExtApp.Msg.info('Please select the data to be deleted!');}}},'-',{text:'Refresh',id:'refreshButton_stockOpnameDetail',tooltip:'Refresh Stock Opname Detail',iconCls:'btn-refresh',handler:function(){var form=Ext.getCmp('form_stockOpname').getForm();if(form.findField('form_type_stockOpname').getValue()=='add'){Ext.getCmp('grid_stockOpnameDetail').store.loadData(me.storeStockOpnameDetail_dataTemp);}else{Ext.getCmp('grid_stockOpnameDetail').store.load();}}}]}]}]}],buttons:[{text:'Print',formBind:true,id:'btnPrint_stockOpname',iconCls:'btn-print',handler:function(){me.print_stockOpname();}},'->',{text:'Save',formBind:true,id:'btnSave_stockOpname',iconCls:'btn-save',handler:function(){me.save_stockOpname();}},{text:'Cancel',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_add_stockOpname');}},{xtype:"component",id:'print_area_StockOpname',autoEl:{tag:"iframe",src:url_report},border:false,hidden:true}],listeners:{show:function(){var form=Ext.getCmp('form_stockOpname').getForm();var sto_id=-1;form.reset();Ext.getCmp('btnSave_stockOpname').setDisabled(false);if(form.findField('form_type_stockOpname').getValue()=='add'){form.findField('sto_date').setValue(phpJs.date("d-m-Y"));Ext.getCmp('btnPrint_stockOpname').setDisabled(true);Ext.getCmp('refreshButton_stockOpnameDetail').setDisabled(true);me.store_stockOpnameDetailTemp.proxy.extraParams.sto_id=sto_id;me.store_stockOpnameDetailTemp.loadData([]);store_ComboboxMasterStoreHouse_sto.load();Ext.getCmp('sto_progress').setValue(true);Ext.getCmp('sto_done').setValue(false);}else{form.setValues(me.edit_data);var sto_id=me.edit_data.id;form.findField('sto_number').setDisabled(true);Ext.getCmp('refreshButton_stockOpnameDetail').setDisabled(false);store_ComboboxMasterStoreHouse_sto.load({callback:function(){Ext.getCmp('storehouse_id_name_sto').select(me.edit_data.storehouse_id);}});if(me.edit_data.sto_status=='done'){}
var myMask=new Ext.LoadMask(Ext.getCmp('grid_stockOpnameDetail'),{msg:"Loading..."});myMask.show();me.store_stockOpnameDetailTemp.proxy.extraParams.sto_id=sto_id;me.store_stockOpnameDetailTemp.load({callback:function(){myMask.hide();}});form.findField('sto_date').setDisabled(false);if(me.edit_data.sto_status=='done'){form.findField('sto_date').setDisabled(true);}
if(me.edit_data.sto_status=='done'){Ext.getCmp('sto_progress').setValue(false);Ext.getCmp('sto_done').setValue(true);Ext.getCmp('btnPrint_stockOpname').setDisabled(false);}else{Ext.getCmp('sto_progress').setValue(true);Ext.getCmp('sto_done').setValue(false);Ext.getCmp('btnPrint_stockOpname').setDisabled(true);}}}}});},upload_stockOpnameDetail:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Upload Stock Opname ';var helperGrid=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');return desktop.createWindow({id:me.id+'_upload_stockOpnameDetail',title:Titletext,width:420,height:130,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:true,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'form',id:'form_upload_stockOpnameDetail',border:0,bodyPadding:10,margin:'0 0 0 0',labelWidth:100,items:[{xtype:'filefield',name:'upload_file',emptyText:'Excel (.xls)',fieldLabel:'File Upload ',margin:'5 0 15 0',width:350,buttonText:'',buttonConfig:{iconCls:'btn-upload'}}]}],buttons:[{text:'Upload',formBind:true,id:'btnSave_upload_stockOpnameDetail',iconCls:'btn-save',handler:function(){me.save_upload_stockOpnameDetail();}},{text:'Cancel',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_upload_stockOpnameDetail');}}],listeners:{show:function(){}}});},add_stockOpnameDetail:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Add Detail ';if(me.formType_Detail=='edit'){Titletext='Update Detail ';}
var form=Ext.getCmp('form_stockOpname').getForm();var get_storehouse_id=form.findField('storehouse_id').getValue()
var store_masterItemDistribution_stockOpname=theApp.getStore('store_masterItemDistribution_stockOpname',false);if(store_masterItemDistribution_stockOpname==false){store_masterItemDistribution_stockOpname=theApp.copyStore('master_pos','store_masterItemDistribution','store_masterItemDistribution_stockOpname');}
store_masterItemDistribution_stockOpname.proxy.extraParams.supplier_id=0;store_masterItemDistribution_stockOpname.proxy.extraParams.item_id=0;store_masterItemDistribution_stockOpname.proxy.extraParams.skip_date=1;store_masterItemDistribution_stockOpname.proxy.extraParams.limit=999999;store_masterItemDistribution_stockOpname.proxy.extraParams.is_dropdown=1;store_masterItemDistribution_stockOpname.proxy.extraParams.is_last_stock=1;store_masterItemDistribution_stockOpname.proxy.extraParams.storehouse_id=get_storehouse_id;store_masterItemDistribution_stockOpname.proxy.extraParams.from_distribution=1;var helperGridDetail=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');return desktop.createWindow({id:me.id+'_add_stockOpnameDetail',title:Titletext,width:420,height:300,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:false,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'form',id:'form_stockOpnameDetail',border:0,bodyPadding:10,margin:'0 0 0 0',items:[{xtype:'hidden',name:'form_type_stockOpnameDetail',value:me.formType_Detail},{xtype:'hidden',name:'id'},{xtype:'hidden',name:'sto_id',value:me.sto_id},{xtype:'hidden',name:'sto_number'},{xtype:'hidden',name:'item_id'},{xtype:'hidden',name:'unit_id'},{xtype:'hidden',name:'item_code'},{xtype:'hidden',name:'item_name'},{xtype:'combobox',name:'item_code_name',fieldLabel:'Items',emptyText:'-(Auto complete)-',width:370,allowBlank:false,store:store_masterItemDistribution_stockOpname,displayField:'item_code_name',valueField:'id',hideTrigger:true,queryMode:'local',anyMatch:true,listeners:{select:function(combo,records,eOpts){var form2=Ext.getCmp('form_stockOpnameDetail').getForm();form2.findField('item_id').setValue(records[0].data.id);form2.findField('item_code').setValue(records[0].data.item_code);form2.findField('item_name').setValue(records[0].data.item_name);form2.findField('item_code_name').setValue(records[0].data.item_code_name);form2.findField('unit_id').setValue(records[0].data.unit_id);form2.findField('unit_name').setValue(records[0].data.unit_name);form2.findField('item_price').setValue(records[0].data.item_price);form2.findField('item_hpp').setValue(records[0].data.item_hpp);form2.findField('last_in').setValue(records[0].data.last_in);form2.findField('jumlah_awal').setValue(records[0].data.total_qty_stok);},specialkey:function(field,e){if(e.getKey()==e.ENTER){var form2=Ext.getCmp('form_stockOpnameDetail').getForm();form2.findField('jumlah_fisik').focus(true);}}}},{xtype:'textfield',name:'unit_name',fieldLabel:'Unit Name',labelWidth:100,width:280,readOnly:true,allowBlank:false},{xtype:'displayfield',name:'item_hpp',fieldLabel:'Item HPP',width:280,hidden:true},{xtype:'displayfield',name:'last_in',fieldLabel:'Last In',width:280,hidden:true},{xtype:'textfield',name:'item_price',fieldLabel:'Price',width:280,hidden:true},{xtype:'numberfield',name:'jumlah_awal',fieldLabel:'Qty Awal',width:200,minValue:0,allowDecimals:true,allowBlank:false,hideTrigger:true,keyNavEnabled:false,mouseWheelEnabled:false},{xtype:'numberfield',name:'jumlah_fisik',fieldLabel:'Qty Fisik',width:200,minValue:0,allowDecimals:true,allowBlank:false,hideTrigger:true,keyNavEnabled:false,mouseWheelEnabled:false},{xtype:'textarea',name:'description',fieldLabel:'Notes',labelSeparator:':',anchor:'100%',width:350,height:40}]}],buttons:[{text:'Save',formBind:true,id:'btnSave_stockOpnameDetail',iconCls:'btn-save',handler:function(){me.save_stockOpnameDetail();}},{text:'Cancel',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_add_stockOpnameDetail');}}],listeners:{show:function(){var form=Ext.getCmp('form_stockOpname').getForm();var form2=Ext.getCmp('form_stockOpnameDetail').getForm();var sto_id=me.sto_id;if(me.formType_Detail=='edit'){form2.setValues(me.edit_data);store_masterItemDistribution_stockOpname.load({callback:function(){}});}else{form2.reset();store_masterItemDistribution_stockOpname.load();}}}});}});