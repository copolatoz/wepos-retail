/**
 * Filename: master_pos.masterSales.js
 * Generated 2019-03-25 at 10:00:02 PM
 */
Ext.define('ExtApp.modules.master_pos.model.model_masterSales',{extend:'Ext.data.Model',alias:'model_masterSales',fields:[{name:'id',type:'int'},{name:'sales_code',type:'string'},{name:'sales_type',type:'string'},{name:'sales_type_text',type:'string'},{name:'sales_name',type:'string'},{name:'sales_percentage',type:'string'},{name:'sales_price',type:'string'},{name:'sales_contract_type',type:'string'},{name:'sales_phone',type:'string'},{name:'sales_email',type:'string'},{name:'sales_address',type:'string'},{name:'sales_company',type:'string'},{name:'date_start',type:'string'},{name:'date_end',type:'string'},{name:'source_from',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'},{name:'sales_name_company_fee',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterSales/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.store.store_masterSales',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterSales',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_salesFeeType',{extend:'Ext.data.Store',fields:['val','name'],data:[{"val":"after_tax","name":"After Tax"},{"val":"before_tax","name":"Before Tax"}],autoLoad:false});Ext.define('ExtApp.modules.master_pos.store.store_salesContractType',{extend:'Ext.data.Store',fields:['val','name'],data:[{"val":"limited_date","name":"Limited Date"},{"val":"unlimited_date","name":"Unlimited Date"}],autoLoad:false});Ext.define("ExtApp.modules.master_pos.view.masterSales",{openWindow:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var store_masterSales_masterSales=theApp.getStore('store_masterSales_masterSales',false);if(store_masterSales_masterSales==false){store_masterSales_masterSales=theApp.copyStore('master_pos','store_masterSales','store_masterSales_masterSales');}
store_masterSales_masterSales.proxy.extraParams.limit=25;store_masterSales_masterSales.proxy.extraParams.show_all_text=0;store_masterSales_masterSales.proxy.extraParams.show_valid_date=1;store_masterSales_masterSales.proxy.extraParams.is_dropdown=0;store_masterSales_masterSales.proxy.extraParams.is_active=1;store_masterSales_masterSales.proxy.extraParams.sales_type=0;store_masterSales_masterSales.proxy.extraParams.keywords='';var helperGrid=theApp.getHelper('Grid');var selModel_masterSales=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_masterSales').down('#deleteButton_masterSales').setDisabled(selections.length==0);}}});me.pagingtb_masterSales=helperGrid.paging({ds:store_masterSales_masterSales,title:'Master Sales'});return desktop.createWindow({id:me.id,title:'Master Sales/Marketing',width:900,height:480,iconCls:'icon-grid',animCollapse:false,constrainHeader:true,resizable:true,maximized:false,border:0,layout:{type:'fit'},items:[{xtype:'gridpanel',margins:'0 0 0 0',region:'center',store:store_masterSales_masterSales,id:'grid_masterSales',scroll:true,selModel:selModel_masterSales,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'sales_code',text:'Sales Code',width:150},{xtype:'gridcolumn',dataIndex:'sales_name',text:'Sales Name',width:150},{xtype:'gridcolumn',dataIndex:'source_from',text:'Source',width:100},{xtype:'gridcolumn',dataIndex:'sales_type_text',text:'Fee.Type',width:100},{xtype:'gridcolumn',dataIndex:'sales_percentage',text:'%',width:70,align:'center'},{xtype:'gridcolumn',dataIndex:'sales_price',text:'Price',width:80,align:'center'},{xtype:'gridcolumn',dataIndex:'sales_contract_type',text:'Contract Type',width:120,align:'center'},{xtype:'gridcolumn',dataIndex:'date_start',text:'Date Start',width:100},{xtype:'gridcolumn',dataIndex:'date_end',text:'Date End',width:100},{xtype:'gridcolumn',dataIndex:'sales_company',text:'Company',width:100},{xtype:'gridcolumn',dataIndex:'sales_phone',text:'Phone',width:100},{xtype:'gridcolumn',dataIndex:'sales_address',text:'Address',width:150},{xtype:'gridcolumn',dataIndex:'is_active_text',text:'Status Active',width:100}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){var getSelection=Ext.getCmp('grid_masterSales').getSelectionModel().selected;if(getSelection.length>0){me.formType='edit';me.edit_data=rec.data;me.createWindow(me,'add_masterSales');}}},bbar:me.pagingtb_masterSales,dockedItems:[{xtype:'toolbar',dock:'top',items:[{xtype:'textfield',name:'keywords',id:'keywords_masterSales',width:200,labelSeparator:'',emptyText:'Keywords: Sales Name',anchor:'100%',listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){me.search_masterSales();}}}},{xtype:'button',text:'Search',itemId:'btnFilterSearch_masterSales',tooltip:'Search',iconCls:'btn-search',handler:function(){me.search_masterSales();}},{xtype:'button',text:'Reset',itemId:'btnResetFilterSearch_masterSales',tooltip:'Reset',iconCls:'btn-reset',handler:function(){me.search_masterSales(true);}},'->',{text:'Add',itemId:'addButton_masterSales',tooltip:'Add New Master Sales/Marketing',iconCls:'btn-add',handler:function(){me.formType='add';me.createWindow(me,'add_masterSales');}},'-',{text:'Delete',itemId:'deleteButton_masterSales',tooltip:'Delete Master Sales/Marketing',iconCls:'btn-delete',disabled:true,handler:function(){var getSelection=Ext.getCmp('grid_masterSales').getSelectionModel().selected;if(getSelection.length>0){me.delete_data=getSelection.items[0].data;me.deleteConfirm_masterSales();}else{ExtApp.Msg.info('Please Select Sales/Marketing!');}}},]}]}],listeners:{show:function(){me.search_masterSales();}}});},add_masterSales:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Add New Sales/Marketing';if(me.formType=='edit'){Titletext='Update Sales/Marketing';}
var store_salesFeeType=theApp.getStore('master_pos.store_salesFeeType',false);var store_salesContractType=theApp.getStore('master_pos.store_salesContractType',false);var store_salesAllowDay=theApp.getStore('master_pos.store_salesAllowDay',false);var phpJs=theApp.getHelper('phpJs');var helperGrid=theApp.getHelper('Grid');var selModel_masterSalesProduct=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_masterSalesProduct').down('#deleteButton_masterSalesProduct').setDisabled(selections.length==0);}}});Ext.apply(Ext.form.field.VTypes,{daterange:function(val,field){var date=field.parseDate(val);if(!date){return false;}
if(field.startDateField&&(!this.dateRangeMax||(date.getTime()!=this.dateRangeMax.getTime()))){var start=field.up('form').down('#'+field.startDateField);start.setMaxValue(date);start.validate();this.dateRangeMax=date;}
else if(field.endDateField&&(!this.dateRangeMin||(date.getTime()!=this.dateRangeMin.getTime()))){var end=field.up('form').down('#'+field.endDateField);end.setMinValue(date);end.validate();this.dateRangeMin=date;}
return true;},daterangeText:'Start date must be less than end date'});return desktop.createWindow({id:me.id+'_add_masterSales',title:Titletext,width:800,height:330,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:false,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'form',id:'form_masterSales',border:0,bodyPadding:10,margin:'0 0 0 0',items:[{xtype:'panel',layout:{type:'column'},fieldLabel:'',border:false,items:[{xtype:'panel',layout:{type:'anchor'},fieldLabel:'',width:350,border:false,margin:'0 40 0 0',items:[{xtype:'hidden',name:'form_type_masterSales',value:me.formType},{xtype:'hidden',name:'id'},{xtype:'textfield',name:'sales_code',fieldLabel:'Code',anchor:'60%',},{xtype:'textfield',name:'sales_name',fieldLabel:'Sales Name',width:350,allowBlank:false},{xtype:'combobox',name:'sales_type',id:'sales_type_masterSales',fieldLabel:'Fee.Type',store:store_salesFeeType,labelSeparator:':',width:350,displayField:'name',queryMode:'local',valueField:'val',typeAhead:true,minChars:1,forceSelection:true,allowBlank:false,listeners:{select:function(combo,records,eOpts){var form=Ext.getCmp('form_masterSales').getForm();form.findField('sales_type').setValue(records[0].data.val);}}},{xtype:'numberfield',name:'sales_percentage',fieldLabel:'Disc.%',width:170,minValue:0,hideTrigger:true,allowDecimals:true,hideTrigger:true},{xtype:'numberfield',name:'sales_price',fieldLabel:'Disc.Price',width:220,minValue:0,hideTrigger:true,allowDecimals:true,hideTrigger:true},{xtype:'textfield',name:'sales_company',fieldLabel:'Company',width:350},{xtype:'textfield',name:'sales_phone',fieldLabel:'Phone No',width:350,allowBlank:false,},{xtype:'textfield',name:'sales_email',fieldLabel:'Email',width:350,allowBlank:false,}]},{xtype:'panel',layout:{type:'anchor'},fieldLabel:'',width:350,border:false,margin:'0 0 0 0',items:[{xtype:'combobox',name:'sales_contract_type',id:'sales_contract_type_masterSales',fieldLabel:'Contract.Type',store:store_salesContractType,labelSeparator:':',width:350,displayField:'name',queryMode:'local',valueField:'val',typeAhead:true,minChars:1,forceSelection:true,allowBlank:false,listeners:{select:function(combo,records,eOpts){var form=Ext.getCmp('form_masterSales').getForm();form.findField('sales_contract_type').setValue(records[0].data.val);if(records[0].data.val=='unlimited_date'){form.findField('date_start').setDisabled(true);form.findField('date_end').setDisabled(true);}else{form.findField('date_start').setDisabled(false);form.findField('date_end').setDisabled(false);}}}},{xtype:'datefield',format:'d-m-Y',submitFormat:'Y-m-d',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',fieldLabel:'Start Date',name:'date_start',itemId:'date_start_masterSales',vtype:'daterange',endDateField:'date_end_masterSales'},{xtype:'datefield',format:'d-m-Y',submitFormat:'Y-m-d',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',fieldLabel:'End Date',name:'date_end',itemId:'date_end_masterSales',vtype:'daterange',startDateField:'date_start_masterSales'},{xtype:'checkbox',name:'is_active',fieldLabel:'Status Active',inputValue:'1'},{xtype:'textarea',name:'sales_address',fieldLabel:'Address',width:350,height:60}]}]}]}],buttons:[{text:'Save',formBind:true,id:'btnSave_masterSales',iconCls:'btn-save',handler:function(){me.save_masterSales();}},{text:'Cancel',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_add_masterSales');}}],listeners:{show:function(){var form=Ext.getCmp('form_masterSales').getForm();if(me.formType=='edit'){form.setValues(me.edit_data);if(me.edit_data.sales_contract_type=='unlimited_date'){form.findField('date_start').setDisabled(true);form.findField('date_end').setDisabled(true);}else{form.findField('date_start').setDisabled(false);form.findField('date_end').setDisabled(false);}
if(me.edit_data.sales_type==0){}}else{form.reset();form.findField('date_start').setValue(phpJs.date("d-m-Y"));form.findField('date_end').setValue(phpJs.date("d-m-Y"));form.findField('is_active').setValue(1);form.findField('sales_percentage').setValue(0);form.findField('sales_price').setValue(0);}
store_salesFeeType.load({callback:function(records,operation,success){if(me.formType=='edit'){Ext.getCmp('sales_type_masterSales').select(me.edit_data.sales_type);}}});store_salesContractType.load({callback:function(records,operation,success){if(me.formType=='edit'){Ext.getCmp('sales_contract_type_masterSales').select(me.edit_data.sales_contract_type);}}});}}});}});