/**
 * Filename: purchase.purchasing.js
 * Generated 2020-11-19 at 10:12:00 PM
 */
Ext.define('ExtApp.modules.master_pos.model.model_masterItem',{extend:'Ext.data.Model',alias:'model_masterItem',fields:[{name:'id',type:'int'},{name:'item_code',type:'string'},{name:'item_sku',type:'string'},{name:'item_name',type:'string'},{name:'item_code_name',type:'string'},{name:'item_name_code',type:'string'},{name:'item_desc',type:'string'},{name:'item_manufacturer',type:'string'},{name:'sales_price',type:'string'},{name:'sales_price_show',type:'string'},{name:'item_price',type:'string'},{name:'item_price_show',type:'string'},{name:'item_hpp',type:'string'},{name:'item_hpp_show',type:'string'},{name:'last_in',type:'string'},{name:'last_in_show',type:'string'},{name:'total_qty_stok',type:'string'},{name:'item_type',type:'string'},{name:'item_type_name',type:'string'},{name:'item_image',type:'string'},{name:'item_image_show',type:'string'},{name:'item_image_src',type:'string'},{name:'category_id',type:'int'},{name:'item_category_name',type:'string'},{name:'item_category_code',type:'string'},{name:'subcategory_id',type:'int'},{name:'item_subcategory_name',type:'string'},{name:'item_subcategory_code',type:'string'},{name:'unit_id',type:'int'},{name:'unit_name',type:'string'},{name:'unit_code',type:'string'},{name:'supplier_id',type:'int'},{name:'supplier_name',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'},{name:'use_for_sales',type:'int'},{name:'use_for_sales_text',type:'string'},{name:'id_ref_menu',type:'int'},{name:'sales_use_tax',type:'int'},{name:'sales_use_tax_text',type:'string'},{name:'sales_use_service',type:'int'},{name:'sales_use_service_text',type:'string'},{name:'is_kerjasama',type:'int'},{name:'is_kerjasama_text',type:'string'},{name:'persentase_bagi_hasil',type:'string'},{name:'total_bagi_hasil',type:'string'},{name:'total_bagi_hasil',type:'string'},{name:'total_bagi_hasil_show',type:'string'},{name:'use_stok_kode_unik',type:'int'},{name:'use_stok_kode_unik_text',type:'string'},{name:'min_stock',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterItem/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.model.model_masterSupplierItem',{extend:'Ext.data.Model',alias:'model_masterSupplierItem',fields:[{name:'id',type:'int'},{name:'supplier_id',type:'string'},{name:'supplier_name',type:'string'},{name:'supplier_address',type:'string'},{name:'unit_id',type:'string'},{name:'unit_name',type:'string'},{name:'unit_code',type:'string'},{name:'supplier_item_id',type:'string'},{name:'item_id',type:'string'},{name:'item_code',type:'string'},{name:'item_code_name',type:'string'},{name:'item_name',type:'string'},{name:'item_price',type:'string'},{name:'item_price_show',type:'string'},{name:'item_hpp',type:'string'},{name:'item_hpp_show',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'},{name:'from_supplier_item',type:'string'},{name:'last_in',type:'string'},{name:'last_in_show',type:'string'},{name:'sales_use_tax',type:'int'},{name:'use_stok_kode_unik',type:'int'},{name:'use_stok_kode_unik_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterSupplierItem/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.model.model_masterSupplier',{extend:'Ext.data.Model',alias:'model_masterSupplier',fields:[{name:'id',type:'int'},{name:'supplier_code',type:'string'},{name:'supplier_name',type:'string'},{name:'supplier_contact_person',type:'string'},{name:'supplier_address',type:'string'},{name:'supplier_city',type:'string'},{name:'supplier_phone',type:'string'},{name:'supplier_fax',type:'string'},{name:'supplier_email',type:'string'},{name:'supplier_status',type:'string'},{name:'supplier_status_text',type:'string'},{name:'keterangan_blacklist',type:'string'},{name:'source_from',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'},{name:'supplier_termin',type:'int'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterSupplier/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.model.model_masterUnit',{extend:'Ext.data.Model',alias:'model_masterUnit',fields:[{name:'id',type:'int'},{name:'unit_name',type:'string'},{name:'unit_code',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterUnit/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.model.model_masterStoreHouse',{extend:'Ext.data.Model',alias:'model_masterStoreHouse',fields:[{name:'id',type:'int'},{name:'storehouse_code',type:'string'},{name:'storehouse_name',type:'string'},{name:'storehouse_desc',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'},{name:'is_primary',type:'int'},{name:'is_primary_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterStoreHouse/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.purchase.model.model_purchasing',{extend:'Ext.data.Model',alias:'model_purchasing',fields:[{name:'id',type:'string'},{name:'temp_id',type:'string'},{name:'purchasing_number',type:'string'},{name:'supplier_id',type:'string'},{name:'supplier_name',type:'string'},{name:'supplier_invoice',type:'string'},{name:'purchasing_date',type:'string'},{name:'purchasing_date_txt',type:'string'},{name:'purchasing_memo',type:'string'},{name:'purchasing_total_qty',type:'string'},{name:'purchasing_sub_total',type:'string'},{name:'purchasing_sub_total_text',type:'string'},{name:'purchasing_discount',type:'string'},{name:'purchasing_discount_text',type:'string'},{name:'purchasing_tax',type:'string'},{name:'purchasing_tax_text',type:'string'},{name:'purchasing_shipping',type:'string'},{name:'purchasing_total_price',type:'string'},{name:'purchasing_total_price_text',type:'string'},{name:'purchasing_payment',type:'string'},{name:'payment_note',type:'string'},{name:'purchasing_status',type:'string'},{name:'purchasing_status_text',type:'string'},{name:'purchasing_project',type:'string'},{name:'purchasing_ship_to',type:'string'},{name:'createdby',type:'string'},{name:'is_active',type:'string'},{name:'is_active_text',type:'string'},{name:'purchasing_number_rl_status',type:'string'},{name:'use_approval',type:'int'},{name:'approval_status',type:'string'},{name:'approval_status_text',type:'string'},{name:'purchasing_termin',type:'int'},{name:'storehouse_id',type:'int'},{name:'storehouse_name',type:'string'},{name:'use_tax',type:'int'},{name:'use_tax_text',type:'string'},],proxy:{type:'ajax',url:appUrl+'purchase/purchasing/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.purchase.model.model_purchasingDetail',{extend:'Ext.data.Model',alias:'model_purchasingDetail',fields:[{name:'id',type:'string'},{name:'temp_id',type:'string'},{name:'purchasing_id',type:'string'},{name:'supplier_item_id',type:'string'},{name:'item_id',type:'string'},{name:'item_code',type:'string'},{name:'item_code_name',type:'string'},{name:'item_name',type:'string'},{name:'item_price',type:'string'},{name:'item_hpp',type:'string'},{name:'item_image',type:'string'},{name:'unit_id',type:'string'},{name:'unit_name',type:'string'},{name:'unit_code',type:'string'},{name:'purchasing_detail_qty',type:'string'},{name:'purchasing_detail_status',type:'string'},{name:'purchasing_detail_purchase',type:'string'},{name:'purchasing_detail_purchase_show',type:'string'},{name:'purchasing_detail_potongan',type:'string'},{name:'purchasing_detail_potongan_show',type:'string'},{name:'purchasing_detail_total',type:'string'},{name:'purchasing_detail_total_show',type:'string'},{name:'nomor',type:'int'},{name:'use_stok_kode_unik',type:'string'},{name:'use_stok_kode_unik_text',type:'string'},],proxy:{type:'ajax',url:appUrl+'purchase/purchasing/gridDataDetail',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.purchase.model.model_purchasingKodeUnik',{extend:'Ext.data.Model',alias:'model_purchasingKodeUnik',fields:[{name:'id',type:'int'},{name:'stod_id',type:'string'},{name:'kode_unik',type:'string'},{name:'varian_name',type:'string'},{name:'use_tax_text',type:'string'},{name:'use_tax',type:'int'}],proxy:{type:'ajax',url:appUrl+'purchase/purchasing/gridDataDetailKodeUnik',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.store.store_masterItem',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterItem',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_masterSupplierItem',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterSupplierItem',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_masterSupplier',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterSupplier',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_masterUnit',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterUnit',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_masterStoreHouse',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterStoreHouse',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.purchase.store.store_purchasing',{extend:'Ext.data.Store',model:'ExtApp.modules.purchase.model.model_purchasing',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.purchase.store.store_purchasingDetail',{extend:'Ext.data.Store',model:'ExtApp.modules.purchase.model.model_purchasingDetail',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.purchase.store.store_purchasingKodeUnik',{extend:'Ext.data.Store',model:'ExtApp.modules.purchase.model.model_purchasingKodeUnik',autoLoad:false,remoteSort:true});Ext.define("ExtApp.modules.purchase.view.purchasing",{openWindow:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var store_purchasing_grid=theApp.getStore('store_purchasing_grid',false);if(store_purchasing_grid==false){store_purchasing_grid=theApp.copyStore('purchase','store_purchasing','store_purchasing_grid');}
store_purchasing_grid.proxy.extraParams.purchasing_status='';store_purchasing_grid.proxy.extraParams.skip_date=0;store_purchasing_grid.proxy.extraParams.is_dropdown=0;store_purchasing_grid.proxy.extraParams.is_rl=0;var helperGrid=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');var selModel_purchasing=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_purchasing').down('#deleteButton_purchasing').setDisabled(selections.length==0);}}});me.use_approval_purchasing=0;me.approval_change_payment_purchasing_done=0;me.pagingtb_purchasing=helperGrid.paging({ds:store_purchasing_grid,title:'Pembelian Langsung'});return desktop.createWindow({id:me.id,title:'Pembelian Langsung',width:850,height:500,iconCls:'icon-grid',animCollapse:false,constrainHeader:true,resizable:true,maximized:false,border:false,border:0,layout:{type:'border'},items:[{xtype:'form',title:'Filter',width:330,region:'west',id:'form_filter_purchasing',split:true,collapsible:true,splitterResize:false,collapseMode:'mini',animCollapse:true,scroll:false,bodyPadding:10,margin:'0 0 0 0',items:[{xtype:'textfield',name:'keywords',labelWidth:60,labelSeparator:'',emptyText:'Keywords: No.Faktur / Supplier Name / Nota Pembelian',anchor:'100%',margin:'0 0 15 0',listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){me.search_purchasing();}}}},{xtype:'panel',border:0,layout:{type:'column'},margin:'0 0 15 0',items:[{xtype:'datefield',fieldLabel:'Tgl Dari',name:'date_from',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 0',labelWidth:65,width:170,value:phpJs.date('01-m-Y'),allowBlank:false},{xtype:'datefield',fieldLabel:' s/d ',name:'date_till',labelSeparator:'',format:'d-m-Y',altFormats:'Y-m-d|d-m-Y|dmY|Ymd',margin:'5 0 0 10',labelWidth:20,width:125,value:phpJs.date('d-m-Y'),allowBlank:false}]},{xtype:'container',style:'text-align:right',border:0,items:[{xtype:'button',text:'Search',scale:'medium',margin:'15 0 0 0',itemId:'btnFilterSearch_purchasing',tooltip:'Search',iconCls:'btn-search',handler:function(){me.search_purchasing();}},{xtype:'button',text:'Reset',scale:'medium',margin:'15 60 0 10',itemId:'btnFilterReset_purchasing',tooltip:'Reset',iconCls:'btn-reset',handler:function(){var form=Ext.getCmp('form_filter_purchasing').getForm();form.reset();form.findField('keywords').setValue('');form.findField('date_from').setValue(phpJs.date('01-m-Y'));form.findField('date_till').setValue(phpJs.date('t-m-Y'));me.search_purchasing();}}]}]},{xtype:'gridpanel',margins:'0 0 0 0',region:'center',store:store_purchasing_grid,id:'grid_purchasing',scroll:true,selModel:selModel_purchasing,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'supplier_id',text:'Supplier ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'purchasing_number',text:'No.Faktur',width:90},{xtype:'datecolumn',dataIndex:'purchasing_date',text:'Tanggal',width:90,format:'d/m/Y'},{xtype:'gridcolumn',dataIndex:'supplier_name',text:'Supplier',width:200},{xtype:'gridcolumn',dataIndex:'purchasing_total_qty',text:'Qty',width:80,align:'center'},{xtype:'gridcolumn',dataIndex:'purchasing_payment',text:'Payment',width:80},{xtype:'gridcolumn',dataIndex:'purchasing_termin',text:'Termin',width:80},{xtype:'gridcolumn',dataIndex:'purchasing_total_price_text',text:'Total Price',width:130},{xtype:'gridcolumn',dataIndex:'supplier_invoice',text:'Nota/Surat Jalan',width:120},{xtype:'gridcolumn',dataIndex:'purchasing_status_text',text:'Status',width:90},{xtype:'gridcolumn',dataIndex:'use_tax_text',text:'Pajak',width:90},{xtype:'gridcolumn',dataIndex:'approval_status_text',text:'Approval',width:90},{xtype:'gridcolumn',dataIndex:'createdby',text:'User Input',width:120}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){var getSelection=Ext.getCmp('grid_purchasing').getSelectionModel().selected;if(getSelection.length>0){me.formType='edit';me.purchasing_id=rec.data.id;me.purchasing_number=rec.data.purchasing_number;me.edit_data=rec.data;me.createWindow(me,'add_purchasing');}}},bbar:me.pagingtb_purchasing,dockedItems:[{xtype:'toolbar',dock:'top',items:[{text:'Filter',itemId:'filterButton_purchasing',tooltip:'Filter Pembelian Langsung',iconCls:'btn-search',listeners:{click:function(){Ext.getCmp('form_filter_purchasing').toggleCollapse();}}},'->',{text:'Tambah/Input',itemId:'addButton_purchasing',tooltip:'Tambah/Input Pembelian Langsung',iconCls:'btn-add',handler:function(){me.formType='add';me.edit_data=[];me.createWindow(me,'add_purchasing');}},'-',{text:'Hapus/Batal',itemId:'deleteButton_purchasing',tooltip:'Hapus/Batal Pembelian Langsung',iconCls:'btn-delete',disabled:true,handler:function(){var getSelection=Ext.getCmp('grid_purchasing').getSelectionModel().selected;if(getSelection.length>0){me.delete_data=getSelection.items[0].data;if(me.delete_data.purchasing_status=='done'){ExtApp.Msg.warning('Tidak bisa di batalkan '+me.delete_data.purchasing_number+'<br/>Pembelian Langsung sudah selesai');}else{me.deleteConfirm_purchasing();}}else{ExtApp.Msg.info('Silahkan Pilih Pembelian Langsung!');}}},'-',{text:'Refresh',itemId:'refreshButton_purchasing',tooltip:'Refresh Data Pembelian Langsung',iconCls:'btn-refresh',handler:function(){Ext.getCmp('grid_purchasing').store.load();}}]}]}],listeners:{boxready:function(){Ext.getCmp('form_filter_purchasing').toggleCollapse();me.search_purchasing();me.load_use_approval_purchasing();},show:function(){}}});},add_purchasing:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Input Pembelian Baru';if(me.formType=='edit'){Titletext='Ubah Pembelian';}
me.store_purchasingDetail=theApp.getStore('purchase.store_purchasingDetail',false);me.store_purchasingDetailTemp=theApp.copyStore('purchase','store_purchasingDetail','store_purchasingDetailTemp');me.store_purchasingDetailTemp.proxy.extraParams.limit=9999999;me.store_purchasingDetailTemp.proxy.extraParams.show_choose_text=0;me.store_purchasingDetailTemp.proxy.extraParams.show_all_text=0;me.store_purchasingDetailTemp.proxy.extraParams.is_dropdown=0;me.store_purchasingDetailTemp.proxy.extraParams.keywords='';me.store_purchasingDetailTemp.proxy.extraParams.purchasing_id='';me.store_purchasingDetailTemp.proxy.extraParams.temp_id='';var store_ComboboxMasterSupplier_purchasingDetail=theApp.getStore('store_ComboboxMasterSupplier_purchasingDetail',false);if(store_ComboboxMasterSupplier_purchasingDetail==false){store_ComboboxMasterSupplier_purchasingDetail=theApp.copyStore('master_pos','store_masterSupplier','store_ComboboxMasterSupplier_purchasingDetail');}
store_ComboboxMasterSupplier_purchasingDetail.proxy.extraParams.limit=9999999;store_ComboboxMasterSupplier_purchasingDetail.proxy.extraParams.show_choose_text=0;store_ComboboxMasterSupplier_purchasingDetail.proxy.extraParams.show_all_text=0;store_ComboboxMasterSupplier_purchasingDetail.proxy.extraParams.is_dropdown=1;store_ComboboxMasterSupplier_purchasingDetail.proxy.extraParams.keywords='';store_ComboboxMasterSupplier_purchasingDetail.proxy.extraParams.validated=1;var store_ComboboxMasterStoreHouse_purchasingDetail=theApp.getStore('store_ComboboxMasterStoreHouse_purchasingDetail',false);if(store_ComboboxMasterStoreHouse_purchasingDetail==false){store_ComboboxMasterStoreHouse_purchasingDetail=theApp.copyStore('master_pos','store_masterStoreHouse','store_ComboboxMasterStoreHouse_purchasingDetail');}
store_ComboboxMasterStoreHouse_purchasingDetail.proxy.extraParams.limit=999999;store_ComboboxMasterStoreHouse_purchasingDetail.proxy.extraParams.is_dropdown=1;store_ComboboxMasterStoreHouse_purchasingDetail.proxy.extraParams.except_primary=1;store_ComboboxMasterStoreHouse_purchasingDetail.proxy.extraParams.is_active=1;store_ComboboxMasterStoreHouse_purchasingDetail.proxy.extraParams.show_all_text=0;store_ComboboxMasterStoreHouse_purchasingDetail.proxy.extraParams.show_choose_text=1;var helperGridDetail=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');var selModel_purchasingDetail=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){}}});var store_purchasing_payment=new Ext.data.Store({fields:['val','name'],data:[{"val":"cash","name":"Tunai / Cash"},{"val":"credit","name":"Tempo / Credit"}],autoLoad:true});var add_parameter='_dc='+phpJs.mktime();add_parameter+='&purchasing_id=';add_parameter+='&do=';var url_report=appUrl+'purchase/purchasing/printPurchasing?'+add_parameter;return desktop.createWindow({id:me.id+'_add_purchasing',title:Titletext,width:800,height:550,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:true,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'panel',height:545,title:'',bodyPadding:5,items:[{xtype:'panel',style:'padding-bottom: 5px;',id:'purchasing_detailArea',title:'',border:1,items:[{xtype:'form',id:'form_purchasing',height:215,title:'',border:0,dockedItems:[{xtype:'panel',bodyPadding:10,width:420,title:'',dock:'left',flex:1,border:false,items:[{xtype:'hidden',name:'form_type_purchasing',value:me.formType},{xtype:'hidden',name:'id'},{xtype:'hidden',name:'temp_id'},{xtype:'fieldcontainer',layout:{type:'column'},width:370,fieldLabel:'',items:[{xtype:'textfield',name:'purchasing_number',fieldLabel:'No.Faktur / Tgl',labelSeparator:'',labelWidth:105,width:220,margin:'0 10 0 0',readOnly:true,value:'AUTO',allowBlank:false},{xtype:'datefield',name:'purchasing_date',labelWidth:0,width:110,fieldLabel:'',format:'d-m-Y',submitFormat:'Y-m-d',allowBlank:false}]},{xtype:'hidden',name:'supplier_id'},{xtype:'combobox',name:'supplier_name',fieldLabel:'Supplier',emptyText:'Ketik Nama Supplier / Pilih (Key Down)',labelWidth:105,anchor:'100%',width:370,allowBlank:false,store:store_ComboboxMasterSupplier_purchasingDetail,displayField:'supplier_name',valueField:'id',queryMode:'local',anyMatch:true,listeners:{select:function(combo,records,eOpts){var form=Ext.getCmp('form_purchasing').getForm();form.findField('supplier_id').setValue(records[0].data.id);form.findField('supplier_name').setValue(records[0].data.supplier_name);form.findField('supplier_invoice').focus(true);form.findField('purchasing_termin').setValue(records[0].data.supplier_termin);},}},{xtype:'numberfield',name:'purchasing_termin',fieldLabel:'Termin (Hari)',labelWidth:105,width:160,anchor:'100%',minValue:0},{xtype:'hidden',name:'storehouse_id'},{xtype:'hidden',name:'storehouse_code'},{xtype:'combobox',name:'storehouse_name',fieldLabel:'Gudang',emptyText:'Pilih Gudang',labelWidth:105,width:300,store:store_ComboboxMasterStoreHouse_purchasingDetail,displayField:'storehouse_name',valueField:'id',queryMode:'local',allowBlank:false,listeners:{select:function(combo,records,eOpts){var form2=Ext.getCmp('form_purchasing').getForm();form2.findField('storehouse_id').setValue(records[0].data.id);form2.findField('storehouse_code').setValue(records[0].data.storehouse_code);form2.findField('storehouse_name').setValue(records[0].data.storehouse_name);}}},{xtype:'textfield',name:'supplier_invoice',fieldLabel:'Nota/Surat Jalan',labelWidth:105,width:370,anchor:'100%',},{xtype:'checkbox',name:'use_tax',fieldLabel:'Pajak',inputValue:'1',labelWidth:105,width:370,},{xtype:'textfield',name:'purchasing_memo',fieldLabel:'Keterangan',anchor:'100%',labelWidth:105,width:370,hidden:true,},{xtype:'textfield',name:'user_username',fieldLabel:'User',anchor:'100%',labelWidth:105,width:300,readOnly:true,allowBlank:true},{xtype:'textfield',id:me.id+'_PurchaseOrder_spv',hidden:true,name:'spv_user',allowEmpty:false},{xtype:'checkbox',name:'is_active',fieldLabel:'Status Active',inputValue:'1',hidden:true},{xtype:'checkbox',name:'approval_status',fieldLabel:'Approval',inputValue:'1',value:'1',labelWidth:130},{xtype:'hidden',name:'old_approval_status',},]},{xtype:'panel',bodyPadding:10,width:360,title:'',dock:'left',flex:1,border:false,items:[{xtype:'combobox',name:'purchasing_payment',fieldLabel:'Payment',anchor:'100%',store:store_purchasing_payment,queryMode:'local',hiddenName:"val",displayField:'name',valueField:'val',typeAhead:true,minChars:1,forceSelection:true,allowBlank:false},{xtype:'hidden',name:'purchasing_sub_total'},{xtype:'textfield',name:'purchasing_sub_total_text',fieldLabel:'Sub Total',anchor:'100%',width:300,minValue:0,readOnly:true,allowBlank:true,listeners:{change:function(){}}},{xtype:'hidden',name:'purchasing_discount'},{xtype:'textfield',name:'purchasing_discount_text',fieldLabel:'Discount',anchor:'100%',width:300,minValue:0,readOnly:true,allowBlank:true,listeners:{change:function(){}}},{xtype:'numberfield',name:'purchasing_tax',fieldLabel:'Tax/PPN',anchor:'100%',width:300,minValue:0,hideTrigger:true,allowDecimals:true,hideTrigger:true,allowBlank:true,listeners:{blur:function(){me.calculate_Purchasing();}}},{xtype:'numberfield',name:'purchasing_shipping',fieldLabel:'Shipping',anchor:'100%',width:300,minValue:0,hideTrigger:true,allowDecimals:true,hideTrigger:true,allowBlank:true,listeners:{blur:function(){me.calculate_Purchasing();}}},{xtype:'hidden',name:'purchasing_total_price'},{xtype:'textfield',name:'purchasing_total_price_text',fieldLabel:'Grand Total',anchor:'100%',width:300,readOnly:true,allowBlank:true},{xtype:'radiogroup',fieldLabel:'Status',labelWidth:90,width:300,items:[{xtype:'radiofield',boxLabel:'Progress',name:'purchasing_status',inputValue:'progress',id:'purchasing_status_progress'},{xtype:'radiofield',boxLabel:'Done/Selesai',name:'purchasing_status',inputValue:'done',id:'purchasing_status_done'}]}]}]}]},{xtype:'gridpanel',height:258,store:me.store_purchasingDetailTemp,id:'grid_purchasingDetail',selModel:selModel_purchasingDetail,scroll:true,border:1,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'Detail ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'purchasing_id',text:'Purchasing ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'supplier_item_id',text:'Supply Item ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_id',text:'Supply ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'unit_id',text:'Unit ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'purchasing_detail_purchase',text:'purchasing_detail_purchase',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'purchasing_detail_potongan',text:'purchasing_detail_potongan',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'purchasing_detail_total',text:'purchasing_detail_total',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_hpp',text:'item_hpp',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_code_name',text:'item_code_name',hidden:true,hideable:false},{xtype:'gridcolumn',width:110,dataIndex:'item_code',text:'Kode Barang',sortable:false},{xtype:'gridcolumn',width:150,dataIndex:'item_name',text:'Nama Barang',sortable:false},{xtype:'gridcolumn',width:70,dataIndex:'use_stok_kode_unik_text',text:'SN/IMEI',align:'center',sortable:false},{xtype:'gridcolumn',width:50,dataIndex:'purchasing_detail_qty',text:'Qty',align:'center',sortable:false},{xtype:'gridcolumn',width:60,dataIndex:'unit_code',text:'Unit',align:'center',sortable:false},{xtype:'gridcolumn',width:100,dataIndex:'purchasing_detail_purchase_show',text:'Hrg.Beli',align:'right',sortable:false},{xtype:'gridcolumn',width:100,dataIndex:'purchasing_detail_potongan_show',text:'Discount',align:'right',sortable:false},{xtype:'gridcolumn',width:100,dataIndex:'purchasing_detail_total_show',text:'Total',align:'right',sortable:false}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){var form=Ext.getCmp('form_purchasing').getForm();if(!me.edit_data){}else{if(me.edit_data.purchasing_status=='done'){ExtApp.Msg.warning('Tidak bisa ubah data, Status Pembelian sudah selesai!');return true;}}
var getSelection=Ext.getCmp('grid_purchasingDetail').getSelectionModel().selected;if(getSelection.length>0){me.formType_Detail='edit';me.edit_data=rec.data;me.createWindow(me,'add_purchasingDetail');}}},dockedItems:[{xtype:'toolbar',dock:'top',items:[{text:'Input Barang/Item',id:'addButton_purchasingDetail',tooltip:'Input Barang/Item',iconCls:'btn-add',handler:function(){var form=Ext.getCmp('form_purchasing').getForm();if(!me.edit_data){}else{if(me.edit_data.purchasing_status=='done'){ExtApp.Msg.warning('Tidak bisa ubah data, Status Pembelian sudah selesai!');return true;}}
if(form.findField('supplier_id').getValue()==''||form.findField('supplier_id').getValue()==0){ExtApp.Msg.warning('Silahkan Pilih Supplier!');return true;}else{me.formType_Detail='add';me.createWindow(me,'add_purchasingDetail');}}},'-',{text:'Delete',id:'deleteButton_purchasingDetail',tooltip:'Delete Barang/Item',iconCls:'btn-delete',disabled:true,handler:function(){if(!me.edit_data){}else{if(me.edit_data.purchasing_status=='done'){ExtApp.Msg.warning('Tidak bisa hapus data, Status Pembelian sudah selesai!');return true;}}
var getSelection=Ext.getCmp('grid_purchasingDetail').getSelectionModel().selected;if(getSelection.length>0){me.delete_data=getSelection.items[0].data;me.deleteConfirm_purchasingDetail();}else{ExtApp.Msg.info('Silahkan Pilih Data!');}}},'->',{xtype:'displayfield',id:'totalQtyDisplay_purchasing',fieldLabel:'Total QTY',value:'0',fieldStyle:'font-weight:bold; font-size:14px;',labelStyle:'font-weight:bold; font-size:14px;',labelWidth:80,width:130,margin:'0 20 0 0',},{text:'Refresh',itemId:'refreshButton_purchasingDetail',tooltip:'Refresh Barang/Item',iconCls:'btn-refresh',handler:function(){Ext.getCmp('grid_purchasingDetail').store.load();}}]}]},{xtype:"component",id:'print_area_purchasing',autoEl:{tag:"iframe",src:url_report},border:false,hidden:true}]}],buttons:[{xtype:'checkbox',id:'detailPrint_purchasing',fieldLabel:'Print Detail',labelSeparator:'',inputValue:'1',labelWidth:75,width:100},'-',{text:'Print',formBind:true,id:'btnPrint_purchasing',iconCls:'btn-print',handler:function(){me.print_purchasing(1);}},{text:'Print-LX',formBind:true,id:'btnPrintLX_purchasing',iconCls:'btn-print',handler:function(){me.print_purchasing(12);}},{text:'Excel',formBind:true,id:'btnExcel_purchasing',iconCls:'btn-excel',handler:function(){me.print_purchasing(2);}},'->',{text:'Simpan Pembelian',formBind:true,id:'btnSave_purchasing_confirm',iconCls:'btn-save',handler:function(){var form=Ext.getCmp('form_purchasing').getForm();var get_approval_status=form.findField('approval_status').getValue();if(get_approval_status==true){me.Verify_purchasing();}else{if(me.formType=='add'){me.save_purchasing();}else{if(me.approval_change_payment_purchasing_done==1){if(me.edit_data.purchasing_status=='done'){me.Verify_payment_purchasing();}else{me.save_purchasing();}}else{me.save_purchasing();}}}}},{xtype:'button',id:me.id+'_btnSave_purchasing',hidden:true,listeners:{click:function(){me.save_purchasing();}}},{text:'Tutup/Batal',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_add_purchasing');}}],listeners:{show:function(){var form=Ext.getCmp('form_purchasing').getForm();me.purchasing_id=0;me.temp_purchasing_id='';me.purchasing_number='';if(me.use_approval_purchasing==1){form.findField('approval_status').show();}else{form.findField('approval_status').hide();}
if(form.findField('form_type_purchasing').getValue()=='add'){form.reset();var myMask=new Ext.LoadMask(Ext.getCmp('purchasing_detailArea'),{msg:"Loading..."});myMask.show();form.findField('purchasing_termin').setValue(0);form.findField('purchasing_payment').setValue('credit');form.findField('is_active').setValue('1');form.findField('use_tax').setValue('1');form.findField('purchasing_date').format='d-m-Y';form.findField('purchasing_date').setValue(new Date());form.findField('supplier_name').setDisabled(false);form.findField('old_approval_status').setValue('');form.findField('purchasing_status').setValue('new');Ext.getCmp('btnPrint_purchasing').setDisabled(true);Ext.getCmp('btnPrintLX_purchasing').setDisabled(true);Ext.getCmp('btnExcel_purchasing').setDisabled(true);Ext.getCmp('addButton_purchasingDetail').setDisabled(false);Ext.getCmp('deleteButton_purchasingDetail').setDisabled(false);store_ComboboxMasterStoreHouse_purchasingDetail.load({callback:function(){form.findField('storehouse_id').setValue(0);form.findField('storehouse_name').setValue('');}});me.store_purchasingDetailTemp.proxy.extraParams.purchasing_id=me.purchasing_id;me.store_purchasingDetailTemp.proxy.extraParams.temp_id=me.temp_purchasing_id;me.store_purchasingDetailTemp.proxy.extraParams.purchasing_number=me.purchasing_number;me.store_purchasingDetailTemp.loadData([]);store_ComboboxMasterSupplier_purchasingDetail.load({callback:function(){form.findField('supplier_id').setValue(0);form.findField('supplier_name').setValue('');}});Ext.getCmp('purchasing_status_progress').setValue(true);Ext.getCmp('purchasing_status_done').setValue(false);me.load_newTempId();myMask.hide();me.calculate_Purchasing();}else{form.setValues(me.edit_data);form.findField('user_username').setValue(user_fullname);me.purchasing_id=me.edit_data.id;me.purchasing_number=me.edit_data.purchasing_number;me.temp_purchasing_id=me.edit_data.purchasing_number;form.findField('temp_id').setValue('');if(me.edit_data.purchasing_status=='done'){Ext.getCmp('purchasing_status_progress').setValue(false);Ext.getCmp('purchasing_status_done').setValue(true);}else{Ext.getCmp('purchasing_status_progress').setValue(true);Ext.getCmp('purchasing_status_done').setValue(false);}
if(me.edit_data.supplier_id>0){form.findField('supplier_name').setReadOnly(true);}else{form.findField('supplier_name').setReadOnly(false);store_ComboboxMasterSupplier_purchasingDetail.load();}
Ext.getCmp('btnPrint_purchasing').setDisabled(false);Ext.getCmp('btnPrintLX_purchasing').setDisabled(false);Ext.getCmp('btnExcel_purchasing').setDisabled(false);store_ComboboxMasterStoreHouse_purchasingDetail.load({callback:function(){form.findField('storehouse_name').setValue(me.edit_data.storehouse_name);}});var purchasing_sub_total=parseFloat(me.edit_data.purchasing_total_price)+parseFloat(me.edit_data.purchasing_discount)-parseFloat(me.edit_data.purchasing_tax)-parseFloat(me.edit_data.purchasing_shipping);form.findField('purchasing_sub_total').setValue(purchasing_sub_total);form.findField('purchasing_sub_total_text').setValue('Rp '+phpJs.priceFormat(purchasing_sub_total));form.findField('purchasing_total_price_text').setValue('Rp '+phpJs.priceFormat(me.edit_data.purchasing_total_price));var myMask=new Ext.LoadMask(Ext.getCmp('purchasing_detailArea'),{msg:"Loading..."});myMask.show();form.findField('old_approval_status').setValue(me.edit_data.approval_status);Ext.getCmp('addButton_purchasingDetail').setDisabled(false);Ext.getCmp('deleteButton_purchasingDetail').setDisabled(false);form.findField('storehouse_name').setDisabled(false);if(me.edit_data.purchasing_status=='done'){Ext.getCmp('addButton_purchasingDetail').setDisabled(true);Ext.getCmp('deleteButton_purchasingDetail').setDisabled(true);form.findField('storehouse_name').setDisabled(true);}else{if(me.edit_data.approval_status=='done'&&me.edit_data.use_approval==1){Ext.getCmp('addButton_purchasingDetail').setDisabled(true);Ext.getCmp('deleteButton_purchasingDetail').setDisabled(true);form.findField('storehouse_name').setDisabled(true);}}
me.store_purchasingDetailTemp.proxy.extraParams.purchasing_id=me.purchasing_id;me.store_purchasingDetailTemp.proxy.extraParams.temp_id=me.temp_purchasing_id;me.store_purchasingDetailTemp.proxy.extraParams.purchasing_number=me.purchasing_number;me.store_purchasingDetailTemp.load({callback:function(){myMask.hide();}});me.load_totalPurchasing();}}}});},add_purchasingDetail:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Input Data Barang ';if(me.formType_Detail=='edit'){Titletext='Ubah Data Barang ';}
me.first_load_masterItemPurchasingAutocomplete=1;me.store_masterItemPurchasingAutocomplete=theApp.getStore('store_masterItemPurchasingAutocomplete',false);if(me.store_masterItemPurchasingAutocomplete==false){me.store_masterItemPurchasingAutocomplete=theApp.copyStore('master_pos','store_masterSupplierItem','store_masterItemPurchasingAutocomplete');}
me.store_masterItemPurchasingAutocomplete.proxy.extraParams.supplier_id=0;me.store_masterItemPurchasingAutocomplete.proxy.extraParams.item_id=0;me.store_masterItemPurchasingAutocomplete.proxy.extraParams.skip_date=1;me.store_masterItemPurchasingAutocomplete.proxy.extraParams.limit=999999;me.store_masterItemPurchasingAutocomplete.proxy.extraParams.is_dropdown=1;me.store_masterItemPurchasingAutocomplete.proxy.extraParams.from_supplier_item=1;me.store_masterItemPurchasingAutocomplete.proxy.extraParams.keywords='';me.store_purchasingKodeUnik=theApp.getStore('store_purchasingKodeUnik',false);if(me.store_purchasingKodeUnik==false){me.store_purchasingKodeUnik=theApp.copyStore('purchase','store_purchasingKodeUnik','store_purchasingKodeUnik');}
me.store_purchasingKodeUnik.proxy.extraParams.limit=999999;me.store_purchasingKodeUnik.proxy.extraParams.purchasing_id=0;me.store_purchasingKodeUnik.proxy.extraParams.purchasing_number='';me.store_purchasingKodeUnik.proxy.extraParams.purchasingd_id=0;me.store_purchasingKodeUnik.proxy.extraParams.temp_id=0;me.store_purchasingKodeUnik.proxy.extraParams.purchasingd_item_id=0;me.store_purchasingKodeUnik.proxy.extraParams.tipe='';me.store_purchasingKodeUnik.proxy.extraParams.query='';var selModel_purchasingKodeUnik=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_purchasingKodeUnik').down('#deleteButton_purchasingKodeUnik').setDisabled(selections.length==0);}}});var helperGridDetail=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');var widthFormpurchasingDetail=770;var heightFormpurchasingDetail=400;var hideGridReceivingKodeUnik=false;if(me.formType_Detail=='edit'){if(me.edit_data.use_stok_kode_unik==0){widthFormpurchasingDetail=370;heightFormpurchasingDetail=350;hideGridReceivingKodeUnik=true;}}
return desktop.createWindow({id:me.id+'_add_purchasingDetail',title:Titletext,width:widthFormpurchasingDetail,height:heightFormpurchasingDetail,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:false,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'form',id:'form_purchasingDetail',border:0,margin:'0 0 0 0',layout:{type:'border'},items:[{xtype:'panel',width:350,region:'center',layout:{type:'auto'},border:0,bodyPadding:10,margin:'0 5 0 0',defaults:{margin:'5 0 0 0',labelSeparator:':',labelWidth:100,width:280},items:[{xtype:'hidden',name:'id'},{xtype:'hidden',name:'form_type_purchasingDetail',value:me.formType_Detail},{xtype:'hidden',name:'purchasing_id',value:me.purchasing_id},{xtype:'hidden',name:'item_id'},{xtype:'hidden',name:'item_hpp'},{xtype:'hidden',name:'supplier_item_id'},{xtype:'hidden',name:'unit_id'},{xtype:'hidden',name:'unit_name'},{xtype:'hidden',name:'purchasing_detail_status'},{xtype:'hidden',name:'item_code_name'},{xtype:'hidden',name:'use_stok_kode_unik'},{xtype:'checkbox',name:'from_supplier_item',fieldLabel:'Item Supplier',inputValue:'1',value:'1',listeners:{change:function(combo,records,eOpts){var form=Ext.getCmp('form_purchasingDetail').getForm();var from_supplier_item=form.findField('from_supplier_item').getSubmitValue();if(from_supplier_item==1){me.store_masterItemPurchasingAutocomplete.proxy.extraParams.from_supplier_item=1;}else{me.store_masterItemPurchasingAutocomplete.proxy.extraParams.from_supplier_item=0;}
if(me.first_load_masterItemPurchasingAutocomplete==1){}else{me.store_masterItemPurchasingAutocomplete.load({callback:function(){if(me.formType=='add'){form.findField('item_name').setValue('');form.findField('item_id').setValue(0);form.findField('item_hpp').setValue(0);}}});}}}},{xtype:'combobox',id:'item_code_name_purchasing',name:'item_code_name',fieldLabel:'Item/Barang',emptyText:'Pilih Barang/Item',width:330,store:me.store_masterItemPurchasingAutocomplete,displayField:'item_code_name',valueField:'item_code_name',queryMode:'local',anyMatch:true,listeners:{select:function(combo,records,eOpts){var form2=Ext.getCmp('form_purchasingDetail').getForm();var purchasing_idx=me.purchasing_id;var purchasingd_idx=0;var purchasingd_item_idx=records[0].data.item_id;var temp_purchasing_idx=me.temp_purchasing_id;var purchasing_numberx=me.purchasing_number;me.purchasingd_item_id=records[0].data.item_id;if(me.formType_Detail=='edit'){var purchasingd_idx=me.edit_data.id;me.purchasingd_id=me.edit_data.id;}else{me.purchasingd_id=0;}
form2.findField('item_id').setValue(records[0].data.item_id);form2.findField('supplier_item_id').setValue(records[0].data.supplier_item_id);form2.findField('item_name').setValue(records[0].data.item_name);form2.findField('item_code').setValue(records[0].data.item_code);form2.findField('item_code_name').setValue(records[0].data.item_code_name);form2.findField('unit_id').setValue(records[0].data.unit_id);form2.findField('unit_name').setValue(records[0].data.unit_name);form2.findField('unit_code').setValue(records[0].data.unit_code);form2.findField('item_hpp').setValue(records[0].data.item_hpp);form2.findField('purchasing_detail_purchase').setValue(records[0].data.last_in);form2.findField('purchasing_detail_potongan').setValue(0);form2.findField('use_stok_kode_unik').setValue(records[0].data.use_stok_kode_unik);form2.findField('use_stok_kode_unik_text').setValue(records[0].data.use_stok_kode_unik_text);if(records[0].data.use_stok_kode_unik==0||records[0].data.use_stok_kode_unik==undefined){Ext.getCmp('grid_purchasingKodeUnik').setDisabled(true);me.store_purchasingKodeUnik.loadData([]);}else{Ext.getCmp('grid_purchasingKodeUnik').setDisabled(false);var form=Ext.getCmp('form_purchasing').getForm();var purchasing_use_tax=form.findField('use_tax').getValue();Ext.getCmp('addKodeUnik_useTax').setValue(purchasing_use_tax);me.store_purchasingKodeUnik.proxy.extraParams.purchasing_id=purchasing_idx;me.store_purchasingKodeUnik.proxy.extraParams.purchasing_number=purchasing_numberx;me.store_purchasingKodeUnik.proxy.extraParams.purchasingd_id=purchasingd_idx;me.store_purchasingKodeUnik.proxy.extraParams.purchasingd_item_id=purchasingd_item_idx;me.store_purchasingKodeUnik.proxy.extraParams.temp_id=temp_purchasing_idx;me.store_purchasingKodeUnik.load();me.load_totalKodeUnikPurchasing();}},specialkey:function(field,e){if(e.getKey()==e.ENTER){var form2=Ext.getCmp('form_purchasingDetail').getForm();form2.findField('purchasing_detail_qty').focus(true);}}}},{xtype:'displayfield',name:'item_code',fieldLabel:'Kode',},{xtype:'displayfield',name:'item_name',fieldLabel:'Nama Barang',width:330},{xtype:'displayfield',name:'unit_code',fieldLabel:'Unit',},{xtype:'numberfield',name:'purchasing_detail_qty',fieldLabel:'Qty',width:200,minValue:0,allowDecimals:true,allowBlank:false,hideTrigger:true,keyNavEnabled:false,mouseWheelEnabled:false,listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){var form2=Ext.getCmp('form_purchasingDetail').getForm();form2.findField('unit_id').focus(true);}}}},{xtype:'numberfield',name:'purchasing_detail_purchase',fieldLabel:'Price',width:280,minValue:0,allowDecimals:true,allowBlank:false,hideTrigger:true,keyNavEnabled:false,mouseWheelEnabled:false,listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){form2.findField('purchasing_detail_potongan').focus();}}}},{xtype:'numberfield',name:'purchasing_detail_potongan',fieldLabel:'Total Potongan',width:280,minValue:0,allowDecimals:true,allowBlank:false,hideTrigger:true,keyNavEnabled:false,mouseWheelEnabled:false,listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){Ext.getCmp('btnSave_purchasingDetail').focus();}}}},{xtype:'displayfield',name:'use_stok_kode_unik_text',fieldLabel:'Gunakan SN/IMEI',}]},{xtype:'gridpanel',region:'east',width:400,height:330,store:me.store_purchasingKodeUnik,id:'grid_purchasingKodeUnik',selModel:selModel_purchasingKodeUnik,scroll:true,border:1,hidden:hideGridReceivingKodeUnik,columns:[{xtype:'gridcolumn',dataIndex:'id',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'purchasingd_id',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'use_tax',hidden:true,hideable:false},{xtype:'gridcolumn',width:60,dataIndex:'use_tax_text',text:'Pajak',hidden:true,hideable:false},{xtype:'gridcolumn',width:120,dataIndex:'varian_name',text:'Varian/Warna',sortable:false},{xtype:'gridcolumn',width:150,dataIndex:'kode_unik',text:'SN/IMEI',sortable:false},],dockedItems:[{xtype:'toolbar',dock:'top',id:'toolbarButton_purchasingKodeUnik',items:[{text:'Tambah SN/IMEI',itemId:'addButton_purchasingKodeUnik',tooltip:'Tambah SN/IMEI',iconCls:'btn-add-circle',handler:function(){Ext.getCmp('toolbarButton_purchasingKodeUnik').hide();Ext.getCmp('toolbarAdd_purchasingKodeUnik').show();}},'->',{text:'Hapus',itemId:'deleteButton_purchasingKodeUnik',tooltip:'Hapus SN/IMEI',iconCls:'btn-reset',disabled:true,handler:function(){var getSelection=Ext.getCmp('grid_purchasingKodeUnik').getSelectionModel().selected;if(getSelection.length>0){me.delete_data_unik=getSelection.items[0].data;me.deleteConfirm_purchasingKodeUnik();}else{ExtApp.Msg.info('Silahkan Pilih SN/IMEI untuk di hapus!');}}},'-',{text:'Refresh',itemId:'refreshButton_purchasingKodeUnik',tooltip:'Refresh  SN/IMEI',iconCls:'btn-refresh',handler:function(){Ext.getCmp('grid_purchasingKodeUnik').store.load();me.load_totalKodeUnikPurchasing();}}]},{xtype:'toolbar',dock:'top',id:'toolbarAdd_purchasingKodeUnik',hidden:true,items:[{xtype:'hidden',name:'kode_unik_id',id:'addKodeUnik_KodeUnikID'},{xtype:'checkbox',name:'new_tax',id:'addKodeUnik_useTax',labelSeparator:'',fieldLabel:'Pajak',labelWidth:35,width:60,hidden:true},{xtype:'textfield',name:'new_varian',id:'addKodeUnik_varianName',fieldLabel:'',width:100,emptyText:'Varian/Warna',},{xtype:'textfield',name:'new_kode_unik',id:'addKodeUnik_KodeUnik',fieldLabel:'',width:140,margin:'0 3 0 0',emptyText:'Input SN/IMEI',listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){me.save_purchasingKodeUnik();}}}},{text:'',itemId:'addButton_purchasingKodeUnik',tooltip:'Simpan SN/IMEI',iconCls:'btn-save',handler:function(){me.save_purchasingKodeUnik();}},'->',{text:'',itemId:'closeAddButton_purchasingKodeUnik',tooltip:'Tutup Input SN/IMEI',iconCls:'btn-cancel',handler:function(){Ext.getCmp('addKodeUnik_varianName').setValue('');Ext.getCmp('addKodeUnik_KodeUnik').setValue('');Ext.getCmp('toolbarButton_purchasingKodeUnik').show();Ext.getCmp('toolbarAdd_purchasingKodeUnik').hide();}},]},{xtype:'toolbar',dock:'bottom',id:'toolbarSearch_purchasingKodeUnik',items:[{xtype:'textfield',name:'search_kodeunik',id:'searchKodeUnik_purchasingKodeUnik',fieldLabel:'',width:200,emptyText:'Cari SN/IMEI',listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){me.search_purchasingKodeUnik();}}}},{text:'',itemId:'searchButton_purchasingKodeUnik',tooltip:'Cari SN/IMEI',iconCls:'btn-search',handler:function(){me.search_purchasingKodeUnik();}},{text:'',itemId:'resetSearchButton_purchasingKodeUnik',tooltip:'Reset',iconCls:'btn-clear',handler:function(){Ext.getCmp('searchKodeUnik_purchasingKodeUnik').setValue('');me.search_purchasingKodeUnik();}},'->',]}]}]}],buttons:[{text:'Simpan & Ulangi',formBind:true,hidden:true,id:'btnSaveUlangi_purchasingDetail',iconCls:'btn-save',handler:function(){me.add_purchasingDetail(1);}},{text:'Simpan',formBind:true,id:'btnSave_purchasingDetail',iconCls:'btn-save',handler:function(){me.add_purchasingDetail(0);}},{text:'Tutup',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_add_purchasingDetail');}}],listeners:{show:function(){var form=Ext.getCmp('form_purchasing').getForm();var form2=Ext.getCmp('form_purchasingDetail').getForm();var purchasing_idx=me.purchasing_id;var purchasingd_idx=0;var purchasingd_item_idx=0;var temp_purchasing_idx=me.temp_purchasing_id;var purchasing_numberx=me.purchasing_number;var purchasingd_use_stok_kode_unik=0;if(me.formType_Detail=='edit'){form2.setValues(me.edit_data);var supplier_id=form.findField('supplier_id').getValue();purchasingd_use_stok_kode_unik=me.edit_data.use_stok_kode_unik;temp_purchasing_idx='';purchasingd_idx=me.edit_data.id;purchasingd_item_idx=me.edit_data.item_id;me.purchasingd_id=me.edit_data.id;me.purchasingd_item_id=me.edit_data.item_id;form2.findField('from_supplier_item').hide();Ext.getCmp('item_code_name_purchasing').hide();Ext.getCmp('btnSave_purchasingDetail').setDisabled(false);if(me.edit_data.purchasing_status=='done'){Ext.getCmp('btnSave_purchasingDetail').setDisabled(true);}
if(purchasingd_use_stok_kode_unik==1){Ext.getCmp('grid_purchasingKodeUnik').setDisabled(false);}}else{form2.findField('from_supplier_item').show();Ext.getCmp('item_code_name_purchasing').show();var supplier_id=form.findField('supplier_id').getValue();me.purchasingd_id=0;me.purchasingd_item_id=0;purchasingd_use_stok_kode_unik=1;purchasingd_idx=0;purchasingd_item_idx=0;me.reset_purchasingDetail();var myMask=new Ext.LoadMask(Ext.getCmp('form_purchasingDetail'),{msg:"Loading..."});myMask.show();me.store_masterItemPurchasingAutocomplete.proxy.extraParams.supplier_id=supplier_id;me.store_masterItemPurchasingAutocomplete.proxy.extraParams.from_supplier_item=1;form2.findField('from_supplier_item').setValue(1);me.store_masterItemPurchasingAutocomplete.load({callback:function(){myMask.hide();me.first_load_masterItemPurchasingAutocomplete=0;}});}
if(purchasingd_use_stok_kode_unik==1){me.store_purchasingKodeUnik.proxy.extraParams.purchasing_id=purchasing_idx;me.store_purchasingKodeUnik.proxy.extraParams.purchasing_number=purchasing_numberx;me.store_purchasingKodeUnik.proxy.extraParams.purchasingd_id=purchasingd_idx;me.store_purchasingKodeUnik.proxy.extraParams.purchasingd_item_id=purchasingd_item_idx;me.store_purchasingKodeUnik.proxy.extraParams.temp_id=temp_purchasing_idx;me.store_purchasingKodeUnik.proxy.extraParams.tipe=me.formType_Detail;me.store_purchasingKodeUnik.proxy.extraParams.query='';me.store_purchasingKodeUnik.load();me.load_totalKodeUnikPurchasing();}
Ext.getCmp('grid_purchasingKodeUnik').setDisabled(true);}}});}});