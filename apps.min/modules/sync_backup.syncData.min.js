/**
 * Filename: sync_backup.syncData.js
 * Generated 2019-04-19 at 09:55:46 AM
 */
Ext.define('ExtApp.modules.sync_backup.model.model_syncData',{extend:'Ext.data.Model',alias:'model_syncData',fields:[{name:'id',type:'int'},{name:'no',type:'string'},{name:'list_info',type:'string'},{name:'store_info',type:'string'}],proxy:{type:'ajax',url:appUrl+'sync_backup/syncData/storeInfo',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.sync_backup.model.model_syncDataDetail',{extend:'Ext.data.Model',alias:'model_syncDataDetail',fields:[{name:'id',type:'int'},{name:'client_id',type:'string'},{name:'client_code',type:'string'},{name:'client_name',type:'string'},{name:'client_email',type:'string'},{name:'sync_data',type:'string'},{name:'sync_data_text',type:'string'},{name:'total_data_lokal',type:'string'},{name:'total_data_server',type:'string'},{name:'last_id_lokal',type:'string'},{name:'last_id_server',type:'string'},{name:'last_update',type:'string'},{name:'sync_status',type:'string'},{name:'sync_status_text',type:'string'},{name:'last_id_on_backup',type:'string'},{name:'total_data_on_backup',type:'string'}],proxy:{type:'ajax',url:appUrl+'sync_backup/syncData/syncDetail',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.sync_backup.model.model_syncDataLog',{extend:'Ext.data.Model',alias:'model_syncDataLog',fields:[{name:'id',type:'int'},{name:'client_id',type:'int'},{name:'backup_date',type:'string'},{name:'backup_data',type:'string'},{name:'backup_data_text',type:'string'},{name:'total_data',type:'string'},{name:'last_id',type:'string'},{name:'auto_manual',type:'string'},{name:'auto_manual_text',type:'string'},{name:'backup_type',type:'string'},{name:'backup_type_text',type:'string'},],proxy:{type:'ajax',url:appUrl+'sync_backup/syncData/syncDataLog',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.sync_backup.store.store_syncData',{extend:'Ext.data.Store',model:'ExtApp.modules.sync_backup.model.model_syncData',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.sync_backup.store.store_syncDataDetail',{extend:'Ext.data.Store',model:'ExtApp.modules.sync_backup.model.model_syncDataDetail',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.sync_backup.store.store_syncDataLog',{extend:'Ext.data.Store',model:'ExtApp.modules.sync_backup.model.model_syncDataLog',autoLoad:false,remoteSort:true});Ext.define("ExtApp.modules.sync_backup.view.syncData",{openWindow:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var store_syncData_grid=theApp.getStore('store_syncData_grid',false);if(store_syncData_grid==false){store_syncData_grid=theApp.copyStore('sync_backup','store_syncData','store_syncData_grid');}
store_syncData_grid.proxy.extraParams.limit=999999;store_syncData_grid.proxy.extraParams.client_id=0;store_syncData_grid.proxy.extraParams.client_code='';store_syncData_grid.proxy.extraParams.client_name='';store_syncData_grid.proxy.extraParams.client_email='';var store_syncDataDetail_grid=theApp.getStore('store_syncDataDetail_grid',false);if(store_syncDataDetail_grid==false){store_syncDataDetail_grid=theApp.copyStore('sync_backup','store_syncDataDetail','store_syncDataDetail_grid');}
store_syncDataDetail_grid.proxy.extraParams.limit=999999;store_syncDataDetail_grid.proxy.extraParams.client_id=0;store_syncDataDetail_grid.proxy.extraParams.client_code='';store_syncDataDetail_grid.proxy.extraParams.client_name='';store_syncDataDetail_grid.proxy.extraParams.client_email='';var helperGrid=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');var selModel_syncDataDetail=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('generateButton_syncData').setDisabled(selections.length==0);Ext.getCmp('generateButton_backupData').setDisabled(selections.length==0);}}});return desktop.createWindow({id:me.id,title:'Backup & Sync - Master Data',width:1000,height:550,iconCls:'icon-sync',animCollapse:false,constrainHeader:true,resizable:true,maximized:false,border:false,border:0,layout:{type:'fit'},items:[{xtype:'panel',border:0,layout:{type:'border'},items:[{xtype:'gridpanel',flex:1,margins:'0 5 0 0',region:'west',store:store_syncData_grid,id:'grid_syncData',scroll:true,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'no',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'list_info',text:' Store Info',width:110,sortable:false},{xtype:'gridcolumn',dataIndex:'store_info',text:'',width:300,sortable:false}],viewConfig:{stripeRows:true,forceFit:true}},{title:'Master Data Detail',xtype:'gridpanel',flex:2,margins:'0 0 0 0',region:'center',store:store_syncDataDetail_grid,id:'grid_syncDataDetail',scroll:true,selModel:selModel_syncDataDetail,columns:[{xtype:'gridcolumn',dataIndex:'sync_data_text',text:'MASTER DATA',width:170,sortable:false},{text:'TOTAL DATA',columns:[{xtype:'gridcolumn',dataIndex:'total_data_lokal',text:'LOKAL',width:70},{xtype:'gridcolumn',dataIndex:'total_data_server',text:'SERVER',width:80},]},{text:'LAST ID',columns:[{xtype:'gridcolumn',dataIndex:'last_id_lokal',text:'LOKAL',width:70},{xtype:'gridcolumn',dataIndex:'last_id_server',text:'SERVER',width:80},]},{xtype:'gridcolumn',dataIndex:'last_update',text:'LAST UPDATE',width:120,sortable:false},{xtype:'gridcolumn',dataIndex:'sync_status_text',text:'STATUS',width:120,sortable:false},],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){}},}],dockedItems:[{xtype:'toolbar',dock:'top',items:[{xtype:'hidden',name:'client_id_syncData',id:'client_id_syncData'},{xtype:'hidden',name:'client_code_syncData',id:'client_code_syncData'},{xtype:'hidden',name:'client_name_syncData',id:'client_name_syncData'},{xtype:'hidden',name:'client_email_syncData',id:'client_email_syncData'},{xtype:'hidden',name:'is_wms_syncData',id:'is_wms_syncData'},{xtype:'button',text:'Koneksikan Store / Refresh',id:'searchButton_syncData',tooltip:'Search',iconCls:'btn-search',handler:function(){me.search_syncData();}},'->',{text:'Log',id:'logButton_syncData',tooltip:'Log Data',iconCls:'btn-lock',listeners:{click:function(){me.client_id_syncData=Ext.getCmp('client_id_syncData').getValue();;me.client_code_syncData=Ext.getCmp('client_code_syncData').getValue();me.client_name_syncData=Ext.getCmp('client_name_syncData').getValue();me.client_email_syncData=Ext.getCmp('client_email_syncData').getValue();me.createWindow(me,'show_syncDataLog');}}}]},{xtype:'toolbar',dock:'bottom',items:[{xtype:'displayfield',id:'displayProgres_syncData',name:'displayProgres_syncData',labelWidth:0,width:350,value:'Pilih Data dan Klik Tombol Backup atau Syncronize'},'->',{text:'Syncronize',id:'generateButton_syncData',tooltip:'Syncronize Data',disabled:true,iconCls:'icon-sync',listeners:{click:function(){var getSelection=Ext.getCmp('grid_syncDataDetail').getSelectionModel().selected;if(getSelection.length>0){me.generateStop_syncData=false;me.generateConfirm_syncData('sync');}else{ExtApp.Msg.info('Silahkan Pilih Data!');}}}},,' ',{text:'Backup',id:'generateButton_backupData',tooltip:'Backup Data',disabled:true,iconCls:'icon-backup',listeners:{click:function(){var is_wms_syncData=Ext.getCmp('is_wms_syncData').getValue();if(is_wms_syncData==1){ExtApp.Msg.warning('Fitur Backup Master Data tidak bisa digunakan jika menggunakan WMS<br/>Master Data dikelola secara terpusat oleh aplikasi WMS');}else{var getSelection=Ext.getCmp('grid_syncDataDetail').getSelectionModel().selected;if(getSelection.length>0){me.generateStop_syncData=false;me.generateConfirm_syncData('backup');}else{ExtApp.Msg.info('Silahkan Pilih Data!');}}}}},{text:'Stop Syncronize',id:'stopButton_syncData',tooltip:'Stop Syncronize',hidden:true,iconCls:'btn-stop',listeners:{click:function(){me.generateStop_syncData=true;Ext.getCmp('generateButton_syncData').show();Ext.getCmp('stopButton_syncData').hide();}}},{text:'Stop Backup',id:'stopButton_backupData',tooltip:'Stop Backup',hidden:true,iconCls:'btn-stop',listeners:{click:function(){me.generateStop_syncData=true;Ext.getCmp('generateButton_backupData').show();Ext.getCmp('stopButton_backupData').hide();}}}]}]}],listeners:{boxready:function(){},show:function(){me.reset_syncDataDetail();Ext.getCmp('client_name_syncData').setValue('');}}});},show_syncDataLog:function(me){var client_id_syncData=Ext.getCmp('client_id_syncData').getValue();var client_name_syncData=Ext.getCmp('client_name_syncData').getValue();var client_code_syncData=Ext.getCmp('client_code_syncData').getValue();var client_email_syncData=Ext.getCmp('client_email_syncData').getValue();if(!client_id_syncData){alert('Store tidak terkoneksi!');return false;}
var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Log Backup: '+client_name_syncData;var store_syncData_syncDataLog=theApp.getStore('store_syncData_syncDataLog',false);if(store_syncData_syncDataLog==false){store_syncData_syncDataLog=theApp.copyStore('sync_backup','store_syncDataLog','store_syncData_syncDataLog');}
store_syncData_syncDataLog.proxy.extraParams.limit=25;store_syncData_syncDataLog.proxy.extraParams.client_id=client_id_syncData;store_syncData_syncDataLog.proxy.extraParams.client_code=client_code_syncData;store_syncData_syncDataLog.proxy.extraParams.client_name=client_name_syncData;store_syncData_syncDataLog.proxy.extraParams.client_email=client_email_syncData;var helperGrid=theApp.getHelper('Grid');var phpJs=theApp.getHelper('phpJs');return desktop.createWindow({id:me.id+'_show_syncDataLog',title:Titletext,width:700,height:500,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:false,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'gridpanel',store:store_syncData_syncDataLog,id:'grid_syncDataLog',scroll:true,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'no',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'backup_date',text:'Backup Time',width:150,sortable:false},{xtype:'gridcolumn',dataIndex:'backup_data_text',text:'Backup Data',width:120,sortable:false},{xtype:'gridcolumn',dataIndex:'total_data',text:'Total',width:80,sortable:false},{xtype:'gridcolumn',dataIndex:'last_id',text:'Last ID',width:80,sortable:false},{xtype:'gridcolumn',dataIndex:'auto_manual_text',text:'Backup By',width:120,sortable:false},{xtype:'gridcolumn',dataIndex:'backup_type_text',text:'Backup From',width:120,sortable:false}],viewConfig:{stripeRows:true,forceFit:true},bbar:helperGrid.paging({ds:store_syncData_syncDataLog,title:'Backup Log'})}],listeners:{show:function(){store_syncData_syncDataLog.load();}}});}});