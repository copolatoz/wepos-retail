/**
 * Filename: cashier.controller.openCashierShift.js
 * Generated 2018-09-04 at 08:55:43 PM
 */
Ext.define('ExtApp.modules.cashier.controller.openCashierShift',{extend:'ExtApp.core.Module',id:'modules.cashier.openCashierShift',isloadModuleStore:true,suspendIfLoadStore:true,init:function(){this.launcher={text:'Open Cashier (Shift)',iconCls:'user'};},useHelper:['supervisor'],ModuleStore:{'billing':[{store_name:'store_tipeShift',autoload:true}]},ModuleModel:{},createWindow:function(me,winID,winFunc){var me=this;var win_func='openWindow';if(winFunc){win_func=winFunc;}
var win_id=me.id;if(winID){win_id=me.id+'_'+winID;if(!winFunc){win_func=winID;}}
var desktop=me.app.getDesktop();var win=me.app.getDesktop().getWindow(win_id);if(!win){me.app.createView('ExtApp.modules.cashier.view.openCashierShift',me,win_func);}else{me.app.desktop.restoreWindow(win);}},doClose:function(winVar){var me=this;var win=me.app.getDesktop().getWindow(winVar);if(win){win.doClose();}},load_openCashierShift:function(){var me=this;var form=Ext.getCmp('form_openCashierShift').getForm();var myMask=new Ext.LoadMask(Ext.getCmp('form_openCashierShift'),{msg:"Loading Open Shift..."});myMask.show();var user_shift=Ext.getCmp('user_shift_openCashierShift').getValue();Ext.Ajax.request({waitMsg:'Saving ...',url:appUrl+'cashier/openCashierShift/loadOpenShift',method:'POST',params:{user_shift:user_shift},success:function(response,options){var rsp=Ext.decode(response.responseText);if(rsp.openShiftData){form.findField('id').setValue(rsp.openShiftData.id);form.findField('tipe_shift').setValue(rsp.openShiftData.tipe_shift);form.findField('user_shift').setValue(rsp.openShiftData.user_shift);form.findField('spv_user').setValue(rsp.openShiftData.spv_user);form.findField('kasir_user').setValue(rsp.openShiftData.kasir_user);form.findField('tanggal_shift').setValue(rsp.openShiftData.tanggal_shift);form.findField('jam_shift').setValue(rsp.openShiftData.jam_shift);form.findField('jumlah_uang_kertas').setValue(rsp.openShiftData.jumlah_uang_kertas);form.findField('jumlah_uang_koin').setValue(rsp.openShiftData.jumlah_uang_koin);form.findField('uang_kertas_100000').setValue(rsp.openShiftData.uang_kertas_100000);form.findField('uang_kertas_50000').setValue(rsp.openShiftData.uang_kertas_50000);form.findField('uang_kertas_20000').setValue(rsp.openShiftData.uang_kertas_20000);form.findField('uang_kertas_10000').setValue(rsp.openShiftData.uang_kertas_10000);form.findField('uang_kertas_5000').setValue(rsp.openShiftData.uang_kertas_5000);form.findField('uang_kertas_2000').setValue(rsp.openShiftData.uang_kertas_2000);form.findField('uang_kertas_1000').setValue(rsp.openShiftData.uang_kertas_1000);form.findField('uang_koin_1000').setValue(rsp.openShiftData.uang_koin_1000);form.findField('uang_koin_500').setValue(rsp.openShiftData.uang_koin_500);form.findField('uang_koin_200').setValue(rsp.openShiftData.uang_koin_200);form.findField('uang_koin_100').setValue(rsp.openShiftData.uang_koin_100);}
myMask.hide();},failure:function(response,options){var rsp=Ext.decode(response.responseText);ExtApp.Msg.warning(rsp.info);myMask.hide();}});},Verify_openCashierShift:function(is_print){var me=this;var get_access_spv=-1;if(!opt_spv_access_active){get_access_spv=-1;}else{get_access_spv=opt_spv_access_active.indexOf("open_close_cashier");}
if(get_access_spv==-1){me.save_openCashierShift(is_print);}else{var form=Ext.getCmp('form_openCashierShift').getForm();if(form.isValid()){var phpJs=me.app.getHelper('phpJs');var supervisor=me.app.getHelper('supervisor');var form=Ext.getCmp('form_openCashierShift').getForm();var kasir_user=form.findField('kasir_user').getValue();var saveBtn=me.id+'_OpenShift_savePrint';if(!is_print){var saveBtn=me.id+'_OpenShift_save';}
var verifySpvData={title:'Open Cashier (Shift)',verifyMode:0,access:'open_close_cashier',log:1,data:'Open Cashier '+kasir_user,spvId:me.id+'_OpenShift_spv',saveBtn:saveBtn};supervisor.login(verifySpvData,me);}}},save_openCashierShift:function(is_print){var me=this;var form=Ext.getCmp('form_openCashierShift').getForm();if(form.isValid()){form.submit({clientValidation:true,scope:me,url:appUrl+'cashier/openCashierShift/saveOpenShift',method:'POST',params:{},waitMsg:'Menyimpan Data...',success:function(mainObj,formObj){var rsp=Ext.decode(formObj.response.responseText);if(rsp.success==false){if(!rsp.info){rsp.info='';}
ExtApp.Msg.error(rsp.info);return;}else{form.setValues(rsp.openShiftData);if(!is_print){ExtApp.Msg.info('Open Cashier (shift) been saved');}else{var d=new Date();Ext.Ajax.request({waitMsg:'Printing...',url:appUrl+'cashier/openCashierShift/doPrint?_dc='+d.getTime(),method:'POST',params:{id:rsp.openShiftData.id},success:function(response,options){ExtApp.Msg.info('Open Cashier (shift) been saved & Print');},failure:function(response,options){ExtApp.Msg.info('Print Open Cashier Failed');}});}
me.doClose(me.id);}},failure:function(mainObj,formObj){var rsp=Ext.decode(formObj.response.responseText);if(!rsp.info){rsp.info='';}
ExtApp.Msg.error(rsp.info);}});}},calc_uang_kertas:function(){var me=this;var form=Ext.getCmp('form_openCashierShift').getForm();var jumlah_uang_kertas=0;var uang_kertas_100000=parseFloat(form.findField('uang_kertas_100000').getValue());var uang_kertas_50000=parseFloat(form.findField('uang_kertas_50000').getValue());var uang_kertas_20000=parseFloat(form.findField('uang_kertas_20000').getValue());var uang_kertas_10000=parseFloat(form.findField('uang_kertas_10000').getValue());var uang_kertas_5000=parseFloat(form.findField('uang_kertas_5000').getValue());var uang_kertas_2000=parseFloat(form.findField('uang_kertas_2000').getValue());var uang_kertas_1000=parseFloat(form.findField('uang_kertas_1000').getValue());if(!uang_kertas_100000){uang_kertas_100000=0;form.findField('uang_kertas_100000').setValue(0);}
if(!uang_kertas_50000){uang_kertas_50000=0;form.findField('uang_kertas_50000').setValue(0);}
if(!uang_kertas_20000){uang_kertas_20000=0;form.findField('uang_kertas_20000').setValue(0);}
if(!uang_kertas_10000){uang_kertas_10000=0;form.findField('uang_kertas_10000').setValue(0);}
if(!uang_kertas_5000){uang_kertas_5000=0;form.findField('uang_kertas_5000').setValue(0);}
if(!uang_kertas_2000){uang_kertas_2000=0;form.findField('uang_kertas_2000').setValue(0);}
if(!uang_kertas_1000){uang_kertas_1000=0;form.findField('uang_kertas_1000').setValue(0);}
jumlah_uang_kertas+=parseFloat(uang_kertas_100000)*100000;jumlah_uang_kertas+=parseFloat(uang_kertas_50000)*50000;jumlah_uang_kertas+=parseFloat(uang_kertas_20000)*20000;jumlah_uang_kertas+=parseFloat(uang_kertas_10000)*10000;jumlah_uang_kertas+=parseFloat(uang_kertas_5000)*5000;jumlah_uang_kertas+=parseFloat(uang_kertas_2000)*2000;jumlah_uang_kertas+=parseFloat(uang_kertas_1000)*1000;form.findField('jumlah_uang_kertas').setValue(jumlah_uang_kertas);},calc_uang_koin:function(){var me=this;var form=Ext.getCmp('form_openCashierShift').getForm();var jumlah_uang_koin=0;var uang_koin_1000=parseFloat(form.findField('uang_koin_1000').getValue());var uang_koin_500=parseFloat(form.findField('uang_koin_500').getValue());var uang_koin_200=parseFloat(form.findField('uang_koin_200').getValue());var uang_koin_100=parseFloat(form.findField('uang_koin_100').getValue());if(!uang_koin_1000){uang_koin_1000=0;form.findField('uang_koin_1000').setValue(0);}
if(!uang_koin_500){uang_koin_500=0;form.findField('uang_koin_500').setValue(0);}
if(!uang_koin_200){uang_koin_200=0;form.findField('uang_koin_200').setValue(0);}
if(!uang_koin_100){uang_koin_100=0;form.findField('uang_koin_100').setValue(0);}
jumlah_uang_koin+=parseFloat(uang_koin_1000)*1000;jumlah_uang_koin+=parseFloat(uang_koin_500)*500;jumlah_uang_koin+=parseFloat(uang_koin_200)*200;jumlah_uang_koin+=parseFloat(uang_koin_100)*100;form.findField('jumlah_uang_koin').setValue(jumlah_uang_koin);}});