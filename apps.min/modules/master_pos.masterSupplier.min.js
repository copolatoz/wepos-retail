/**
 * Filename: master_pos.masterSupplier.js
 * Generated 2019-03-25 at 09:59:55 PM
 */
Ext.define('ExtApp.modules.master_pos.model.model_masterSupplier',{extend:'Ext.data.Model',alias:'model_masterSupplier',fields:[{name:'id',type:'int'},{name:'supplier_code',type:'string'},{name:'supplier_name',type:'string'},{name:'supplier_contact_person',type:'string'},{name:'supplier_address',type:'string'},{name:'supplier_phone',type:'string'},{name:'supplier_fax',type:'string'},{name:'supplier_email',type:'string'},{name:'supplier_status',type:'string'},{name:'supplier_status_text',type:'string'},{name:'keterangan_blacklist',type:'string'},{name:'source_from',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterSupplier/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.model.model_masterSupplierItem',{extend:'Ext.data.Model',alias:'model_masterSupplierItem',fields:[{name:'id',type:'int'},{name:'supplier_id',type:'string'},{name:'supplier_name',type:'string'},{name:'supplier_address',type:'string'},{name:'unit_id',type:'string'},{name:'unit_name',type:'string'},{name:'supplier_item_id',type:'string'},{name:'item_id',type:'string'},{name:'item_code',type:'string'},{name:'item_code_name',type:'string'},{name:'item_name',type:'string'},{name:'item_price',type:'string'},{name:'item_price_show',type:'string'},{name:'item_hpp',type:'string'},{name:'item_hpp_show',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'},{name:'from_supplier_item',type:'string'},{name:'last_in',type:'string'},{name:'last_in_show',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterSupplierItem/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.model.model_masterItem',{extend:'Ext.data.Model',alias:'model_masterItem',fields:[{name:'id',type:'int'},{name:'item_code',type:'string'},{name:'item_sku',type:'string'},{name:'item_name',type:'string'},{name:'item_code_name',type:'string'},{name:'item_name_code',type:'string'},{name:'item_desc',type:'string'},{name:'item_manufacturer',type:'string'},{name:'sales_price',type:'string'},{name:'sales_price_show',type:'string'},{name:'item_price',type:'string'},{name:'item_price_show',type:'string'},{name:'item_hpp',type:'string'},{name:'item_hpp_show',type:'string'},{name:'last_in',type:'string'},{name:'last_in_show',type:'string'},{name:'total_qty_stok',type:'string'},{name:'item_type',type:'string'},{name:'item_type_name',type:'string'},{name:'item_image',type:'string'},{name:'item_image_show',type:'string'},{name:'item_image_src',type:'string'},{name:'category_id',type:'int'},{name:'item_category_name',type:'string'},{name:'item_category_code',type:'string'},{name:'subcategory1_id',type:'int'},{name:'item_subcategory1_name',type:'string'},{name:'item_subcategory1_code',type:'string'},{name:'subcategory2_id',type:'int'},{name:'item_subcategory2_name',type:'string'},{name:'item_subcategory2_code',type:'string'},{name:'subcategory3_id',type:'int'},{name:'item_subcategory3_name',type:'string'},{name:'item_subcategory3_code',type:'string'},{name:'subcategory4_id',type:'int'},{name:'item_subcategory4_name',type:'string'},{name:'item_subcategory4_code',type:'string'},{name:'unit_id',type:'int'},{name:'unit_name',type:'string'},{name:'unit_code',type:'string'},{name:'supplier_id',type:'int'},{name:'supplier_name',type:'string'},{name:'is_active',type:'int'},{name:'is_active_text',type:'string'},{name:'use_for_sales',type:'int'},{name:'use_for_sales_text',type:'string'},{name:'id_ref_menu',type:'int'},{name:'sales_use_tax',type:'int'},{name:'sales_use_tax_text',type:'string'},{name:'sales_use_service',type:'int'},{name:'sales_use_service_text',type:'string'},{name:'is_kerjasama',type:'int'},{name:'is_kerjasama_text',type:'string'},{name:'persentase_bagi_hasil',type:'string'},{name:'total_bagi_hasil',type:'string'},{name:'total_bagi_hasil',type:'string'},{name:'total_bagi_hasil_show',type:'string'},{name:'use_stok_kode_unik',type:'int'},{name:'use_stok_kode_unik_text',type:'string'},{name:'min_stock',type:'string'}],proxy:{type:'ajax',url:appUrl+'master_pos/masterItem/gridData',extraParams:{},actionMethods:{read:'POST'},reader:{type:'json',root:'data',idProperty:'id',totalProperty:'totalCount'}}});Ext.define('ExtApp.modules.master_pos.store.store_masterSupplier',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterSupplier',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_masterSupplierItem',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterSupplierItem',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_masterItem',{extend:'Ext.data.Store',model:'ExtApp.modules.master_pos.model.model_masterItem',autoLoad:false,remoteSort:true});Ext.define('ExtApp.modules.master_pos.store.store_masterStatus',{extend:'Ext.data.Store',fields:['val','name'],data:[{"val":"ok","name":"OK"},{"val":"warning","name":"Warning"},{"val":"blacklist","name":"Blaclist"}],autoLoad:false});Ext.define("ExtApp.modules.master_pos.view.masterSupplier",{openWindow:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var phpJs=me.app.getHelper('phpJs');var add_parameter='_dc='+phpJs.mktime();add_parameter+='&module=master_pos';add_parameter+='&file=masterSupplier';add_parameter+='&action=print_masterSupplier';var url_report='';var helperGrid=theApp.getHelper('Grid');var store_masterSupplier_masterSupplier=theApp.getStore('store_masterSupplier_masterSupplier',false);if(store_masterSupplier_masterSupplier==false){store_masterSupplier_masterSupplier=theApp.copyStore('master_pos','store_masterSupplier','store_masterSupplier_masterSupplier');}
store_masterSupplier_masterSupplier.proxy.extraParams.limit=9999999;store_masterSupplier_masterSupplier.proxy.extraParams.show_choose_text=0;store_masterSupplier_masterSupplier.proxy.extraParams.show_all_text=0;store_masterSupplier_masterSupplier.proxy.extraParams.is_dropdown=0;store_masterSupplier_masterSupplier.proxy.extraParams.keywords='';store_masterSupplier_masterSupplier.proxy.extraParams.validated=0;var selModel_masterSupplier=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_masterSupplier').down('#deleteButton_masterSupplier').setDisabled(selections.length==0);}}});me.pagingtb_masterSupplier=helperGrid.paging({ds:store_masterSupplier_masterSupplier,title:'Supplier'});return desktop.createWindow({id:me.id,title:'Supplier & Supplier Item',width:900,height:450,iconCls:'icon-grid',animCollapse:false,constrainHeader:true,resizable:true,maximized:false,border:0,layout:{type:'fit'},items:[{xtype:'gridpanel',margins:'0 0 0 0',region:'center',store:store_masterSupplier_masterSupplier,id:'grid_masterSupplier',scroll:true,selModel:selModel_masterSupplier,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'supplier_code',text:'Code',width:100},{xtype:'gridcolumn',dataIndex:'supplier_name',text:'Nama Supplier / Perusahaan',width:200},{xtype:'gridcolumn',dataIndex:'supplier_contact_person',text:'Kontak',width:110},{xtype:'gridcolumn',dataIndex:'source_from',text:'Source',width:90},{xtype:'gridcolumn',dataIndex:'supplier_status_text',text:'Status',width:90},{xtype:'gridcolumn',dataIndex:'is_active_text',text:'Active',width:90},{xtype:'gridcolumn',dataIndex:'supplier_phone',text:'Phone',width:100},{xtype:'gridcolumn',dataIndex:'supplier_fax',text:'Fax',width:100},{xtype:'gridcolumn',dataIndex:'supplier_email',text:'Email',width:100},{xtype:'gridcolumn',dataIndex:'supplier_address',text:'Address',width:150}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){var getSelection=Ext.getCmp('grid_masterSupplier').getSelectionModel().selected;if(getSelection.length>0){me.formType='edit';me.edit_data=rec.data;me.createWindow(me,'add_masterSupplier');}}},bbar:me.pagingtb_masterSupplier,dockedItems:[{xtype:'toolbar',dock:'top',items:[{xtype:'textfield',name:'keywords',id:'keywords_masterSupplier',width:200,labelSeparator:'',emptyText:'Keywords: Supplier Name',anchor:'100%',listeners:{specialkey:function(field,e){if(e.getKey()==e.ENTER){me.search_masterSupplier();}}}},{xtype:'button',text:'Search',itemId:'btnFilterSearch_masterSupplier',tooltip:'Search',iconCls:'btn-search',handler:function(){me.search_masterSupplier();}},{xtype:'button',text:'Reset',itemId:'btnResetFilterSearch__masterSupplier',tooltip:'Reset',iconCls:'btn-reset',handler:function(){me.search_masterSupplier(true);}},'->',{text:'Add',itemId:'addButton_masterSupplier',tooltip:'Add Supplier',iconCls:'btn-add',handler:function(){me.formType='add';me.createWindow(me,'add_masterSupplier');}},'-',{text:'Delete',itemId:'deleteButton_masterSupplier',tooltip:'Delete Supplier',iconCls:'btn-delete',disabled:true,handler:function(){var getSelection=Ext.getCmp('grid_masterSupplier').getSelectionModel().selected;if(getSelection.length>0){me.delete_data=getSelection.items[0].data;me.deleteConfirm_masterSupplier();}else{ExtApp.Msg.info('Please Select Supplier!');}}},'-',{text:'Print',itemId:'Button_printMasterSupplier',tooltip:'Print Data',iconCls:'icon-print',handler:function(){me.print_masterSupplier();}},{text:'Download',itemId:'Button_downloadMasterSupplier',tooltip:'Download Data (Excel)',iconCls:'icon-download',handler:function(){me.download_masterSupplierExcel();}}]}]},{xtype:"component",id:'print_area_masterSupplier',autoEl:{tag:"iframe",src:url_report},border:false,hidden:true}],listeners:{boxready:function(){me.search_masterSupplier();},show:function(){}}});},add_masterSupplier:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Add New ';if(me.formType=='edit'){Titletext='Update ';}
var helperGrid=theApp.getHelper('Grid');var selModel_masterSupplierItem=Ext.create('Ext.selection.CheckboxModel',{listeners:{selectionchange:function(sm,selections){Ext.getCmp('grid_masterSupplierItem').down('#deleteButton_masterSupplierItem').setDisabled(selections.length==0);}}});var store_masterSupplierItem_grid=theApp.getStore('store_masterSupplierItem_grid',false);if(store_masterSupplierItem_grid==false){store_masterSupplierItem_grid=theApp.copyStore('master_pos','store_masterSupplierItem','store_masterSupplierItem_grid');}
store_masterSupplierItem_grid.proxy.extraParams.skip_date=1;store_masterSupplierItem_grid.proxy.extraParams.limit=999999;store_masterSupplierItem_grid.proxy.extraParams.is_dropdown=0;store_masterSupplierItem_grid.proxy.extraParams.item_id=0;store_masterSupplierItem_grid.proxy.extraParams.is_dropdown=0;store_masterSupplierItem_grid.proxy.extraParams.from_supplier_item=1;var store_masterStatus=theApp.getStore('master_pos.store_masterStatus',false);return desktop.createWindow({id:me.id+'_add_masterSupplier',title:Titletext,width:700,height:430,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:false,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:{xtype:'tabpanel',minHeight:430,activeTab:0,border:false,defaults:{bodyPadding:'10 10 10 10',layout:'auto'},items:[{title:'Supplier Info',height:350,items:[{xtype:'form',id:'form_masterSupplier',border:0,bodyPadding:10,margin:'0 0 0 0',items:[{xtype:'hidden',name:'form_type_masterSupplier',value:me.formType},{xtype:'hidden',name:'id'},{xtype:'textfield',name:'supplier_code',fieldLabel:'Code',anchor:'60%',},{xtype:'textfield',name:'supplier_name',fieldLabel:'Supplier Name',anchor:'100%',allowBlank:false},{xtype:'textfield',name:'supplier_phone',fieldLabel:'Phone',anchor:'90%',hideTrigger:true,allowBlank:false},{xtype:'textfield',name:'supplier_fax',fieldLabel:'Fax',anchor:'90%',hideTrigger:true,allowBlank:true},{xtype:'textfield',name:'supplier_email',fieldLabel:'Email',anchor:'90%',vtype:'email',allowBlank:false},{xtype:'textfield',name:'supplier_contact_person',fieldLabel:'Contact Person',anchor:'100%',allowBlank:true},{xtype:'textfield',name:'supplier_address',fieldLabel:'Address',anchor:'100%',allowBlank:true},{xtype:'checkbox',name:'is_active',fieldLabel:'Status Active',inputValue:'1'},{xtype:'combobox',name:'supplier_status',id:'supplier_status_masterSupplier',fieldLabel:'Status',store:store_masterStatus,labelSeparator:':',width:200,displayField:'name',queryMode:'local',valueField:'val',typeAhead:true,minChars:1,forceSelection:true,allowBlank:true,listeners:{select:function(combo,records,eOpts){}}},{xtype:'textfield',name:'keterangan_blacklist',fieldLabel:'Ket.Blacklist',anchor:'100%',allowBlank:true}]}]},{title:'Supplier Items',id:'supplier_item_list',bodyPadding:'0 0 0 0',height:350,items:[{xtype:'gridpanel',margins:'0 0 0 0',border:0,height:285,store:store_masterSupplierItem_grid,id:'grid_masterSupplierItem',scroll:true,selModel:selModel_masterSupplierItem,columns:[{xtype:'gridcolumn',dataIndex:'id',text:'ID',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'supplier_id',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_id',hidden:true,hideable:false},{xtype:'gridcolumn',dataIndex:'item_name',text:'Name',width:250},{xtype:'gridcolumn',dataIndex:'unit_name',text:'Unit',width:150},{xtype:'gridcolumn',dataIndex:'item_price_show',text:'Hrg.Beli',width:100,align:'right'},{xtype:'gridcolumn',dataIndex:'item_hpp_show',text:'Average',width:100,align:'right'}],viewConfig:{stripeRows:true,forceFit:true},listeners:{itemdblclick:function(view,rec,item,index,eventObj){var getSelection=Ext.getCmp('grid_masterSupplierItem').getSelectionModel().selected;if(getSelection.length>0){me.formType_listSupplier='edit';me.edit_data_listSupplier=rec.data;me.createWindow(me,'add_masterSupplierItem');}}},dockedItems:[{xtype:'toolbar',dock:'top',items:['->',{text:'Add',itemId:'addButton_masterSupplierItem',tooltip:'Add Item Supplier',iconCls:'btn-add',handler:function(){me.formType_listSupplier='add';me.createWindow(me,'add_masterSupplierItem');}},'-',{text:'Delete',itemId:'deleteButton_masterSupplierItem',tooltip:'Delete Item Supplier',iconCls:'btn-delete',disabled:true,handler:function(){var getSelection=Ext.getCmp('grid_masterSupplierItem').getSelectionModel().selected;if(getSelection.length>0){me.delete_data_listSupplier=getSelection.items[0].data;me.deleteConfirm_masterSupplierItem();}else{ExtApp.Msg.info('Please Select Supplier Item!');}}},'-',{text:'Refresh',itemId:'refreshButton_masterSupplierItem',tooltip:'Refresh List Supplier Item',iconCls:'btn-refresh',handler:function(){Ext.getCmp('grid_masterSupplierItem').store.load();}},{text:'Print',itemId:'printButton_masterSupplierItem',tooltip:'Print Data Item',iconCls:'icon-print',handler:function(){me.print_masterSupplierItem();}}]}]}]}]},buttons:[{text:'Save',formBind:true,id:'btnSave_masterSupplier',iconCls:'btn-save',handler:function(){me.save_masterSupplier();}},{text:'Cancel',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_add_masterSupplier');}}],listeners:{show:function(){var form=Ext.getCmp('form_masterSupplier').getForm();if(me.formType=='edit'){form.setValues(me.edit_data);Ext.getCmp('grid_masterSupplierItem').store.proxy.extraParams.supplier_id=me.edit_data.id;Ext.getCmp('grid_masterSupplierItem').store.load();Ext.getCmp('supplier_item_list').setDisabled(false);}else{form.reset();form.findField('is_active').setValue(1);Ext.getCmp('supplier_item_list').setDisabled(true);}}}});},add_masterSupplierItem:function(me){var theApp=me.app;var desktop=theApp.getDesktop();var Titletext='Add Supplier Item ';if(me.formType=='edit'){Titletext='Update Supplier Item: ';}
var store_masterItemAutocomplete=theApp.getStore('store_masterItemAutocomplete',false);if(store_masterItemAutocomplete==false){store_masterItemAutocomplete=theApp.copyStore('master_pos','store_masterItem','store_masterItemAutocomplete');}
store_masterItemAutocomplete.proxy.extraParams.skip_date=1;store_masterItemAutocomplete.proxy.extraParams.limit=999999;store_masterItemAutocomplete.proxy.extraParams.is_dropdown=1;return desktop.createWindow({id:me.id+'_add_masterSupplierItem',title:Titletext,width:400,height:220,iconCls:'btn-add',animCollapse:false,constrainHeader:true,resizable:false,minimizable:false,maximizable:false,modal:true,border:0,layout:{type:'fit'},items:[{xtype:'form',id:'form_masterSupplierItem',border:0,bodyPadding:10,margin:'0 0 0 0',items:[{xtype:'hidden',name:'form_type_masterSupplierItem',value:me.formType_listSupplier},{xtype:'hidden',name:'supplier_id'},{xtype:'hidden',name:'id'},{xtype:'hidden',name:'unit_id'},{xtype:'hidden',name:'item_id'},{xtype:'combobox',name:'item_name',fieldLabel:'Items',emptyText:'-(Auto complete)-',anchor:'100%',labelWidth:100,allowBlank:false,store:store_masterItemAutocomplete,displayField:'item_name',valueField:'id',hideTrigger:true,queryMode:'local',anyMatch:true,listConfig:{emptyText:'Tidak ada data',minWidth:350,getInnerTpl:function(){return'{item_name}';}},pageSize:0,listeners:{select:function(combo,records,eOpts){var form=Ext.getCmp('form_masterSupplierItem').getForm();form.findField('item_id').setValue(records[0].data.id);form.findField('item_name').setValue(records[0].data.item_name);form.findField('unit_id').setValue(records[0].data.unit_id);form.findField('unit_name').setValue(records[0].data.unit_name);form.findField('item_price').setValue(records[0].data.item_price);form.findField('item_hpp').setValue(records[0].data.item_hpp);}}},{xtype:'textfield',name:'unit_name',fieldLabel:'Unit',labelWidth:100,anchor:'80%',readOnly:true,allowBlank:false},{xtype:'textfield',name:'item_price',fieldLabel:'Harga Beli',labelWidth:100,anchor:'80%',allowBlank:false},{xtype:'textfield',name:'item_hpp',fieldLabel:'Harga Beli (Average)',labelWidth:100,anchor:'80%',allowBlank:false}]}],buttons:[{text:'Save',formBind:true,id:'btnSave_masterSupplierItem',iconCls:'btn-save',handler:function(){me.save_masterSupplierItem();}},{text:'Cancel',iconCls:'btn-cancel',handler:function(){me.doClose(me.id+'_add_masterSupplierItem');}}],listeners:{show:function(){var form=Ext.getCmp('form_masterSupplierItem').getForm();var myMask=new Ext.LoadMask(Ext.getCmp('form_masterSupplierItem'),{msg:"Loading..."});myMask.show();if(me.formType_listSupplier=='edit'){form.setValues(me.edit_data_listSupplier);}else{form.reset();}
form.findField('supplier_id').setValue(me.edit_data.id);store_masterItemAutocomplete.load({callback:function(records,operation,success){var item_id=0;var item_name='';if(me.formType_listSupplier=='edit'){item_id=me.edit_data_listSupplier.item_id;item_name=me.edit_data_listSupplier.item_name;}
form.findField('item_id').setValue(item_id);form.findField('item_name').setValue(item_name);myMask.hide();}});}}});}});