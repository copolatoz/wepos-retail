/**
 * Filename: billing.controller.listPaidBilling.js
 * Generated 2021-01-01 at 03:47:21 AM
 */
Ext.define('ExtApp.modules.billing.controller.listPaidBilling',{extend:'ExtApp.core.Module',id:'modules.billing.listPaidBilling',isloadModuleStore:true,suspendIfLoadStore:true,init:function(){this.launcher={text:'List Paid Billing',iconCls:'icon-grid'};},useHelper:[],ModuleStore:{'billing':[{store_name:'store_dataBilling',autoload:false}]},ModuleModel:{'billing':[{model_name:'model_dataBilling'}]},createWindow:function(me,winID,winFunc){var me=this;var win_func='openWindow';if(winFunc){win_func=winFunc;}
var win_id=me.id;if(winID){win_id=me.id+'_'+winID;if(!winFunc){win_func=winID;}}
var desktop=me.app.getDesktop();var win=me.app.getDesktop().getWindow(win_id);if(!win){me.app.createView('ExtApp.modules.billing.view.listPaidBilling',me,win_func);}else{me.app.desktop.restoreWindow(win);}},doClose:function(winVar){var me=this;var win=me.app.getDesktop().getWindow(winVar);if(win){win.doClose();}},printBillingConfirm_listPaidBilling:function(){var me=this;if(me.setBilling_data.id){var getSelection=Ext.getCmp('grid_listPaidBilling').getSelectionModel().selected;var print_var={allID:0,allName:''};for(x in getSelection.items){print_var.allID=getSelection.items[x].data.id;if(print_var.allName==''){print_var.allName=getSelection.items[x].data.billing_no;}else{print_var.allName+=', '+getSelection.items[x].data.billing_no;}}
if(getSelection.length>1){ExtApp.Msg.info("Select Only 1 Billing To Print!");return false;}
ExtApp.Msg.confirm('Print Billing to Cashier Printer: '+print_var.allName+' ?',false,function(btn){if(btn=='yes'){me.printBilling_listPaidBilling(print_var);}else{return false;}});}else{ExtApp.Msg.info("Please choose billing!");}},printBilling_listPaidBilling:function(print_var){var me=this;if(!print_var.allID){ExtApp.Msg.info("Data Tidak Dikenali!");return;}
Ext.Ajax.request({waitMsg:'Set to Cancel ...',url:appUrl+'cashier/billingCashier/doPrint',method:'POST',params:{id:print_var.allID,print_type:0,tipe:'payBilling'},success:function(response,options){var rsp=Ext.decode(response.responseText);if(rsp.success==false){ExtApp.Msg.warning(rsp.info);}
Ext.getCmp('grid_listPaidBilling').store.load();},failure:function(response,options){var rsp=Ext.decode(response.responseText);ExtApp.Msg.warning(rsp.info);}});},print_listPaidBill:function(do_print){var me=this;var theApp=me.app;var phpJs=me.app.getHelper('phpJs');var GUtil=theApp.getHelper('GUtil');if(!do_print){var do_print=0;}
var do_print_tipe='';if(do_print==1){do_print_tipe='print';}
var add_parameter='_dc='+phpJs.mktime();add_parameter+='&id='+me.data_billing.billing_id;add_parameter+='&do='+do_print_tipe;var url_report=appUrl+'billing/dataBilling/show_listPaidBilling?'+add_parameter;var getIframe=Ext.getCmp('print_area_listPaidBilling').getEl().dom;getIframe.src=url_report;},search_listPaidBilling:function(){var form=Ext.getCmp('form_filter_listPaidBilling').getForm();var store_listPaidBilling=Ext.getCmp('grid_listPaidBilling').store;var keywords=form.findField('keywords').getValue();var use_range_date=form.findField('use_range_date').getSubmitValue();if(!use_range_date){use_range_date=0;}
var by_product_order=form.findField('by_product_order').getSubmitValue();if(!by_product_order){by_product_order=0;}
if(by_product_order==1){if(use_range_date==0){ExtApp.Msg.warning('Please use range period (checked) to use this filter<br/>This filter may load huge data of billing detail!');return false;}
if(keywords==''){ExtApp.Msg.warning('Please type a keyword to use this filter');}}
store_listPaidBilling.proxy.extraParams.keywords=keywords;store_listPaidBilling.proxy.extraParams.use_range_date=use_range_date;store_listPaidBilling.proxy.extraParams.by_product_order=by_product_order;store_listPaidBilling.proxy.extraParams.date_from=Ext.Date.format(form.findField('date_from').getValue(),'d-m-Y');store_listPaidBilling.proxy.extraParams.date_till=Ext.Date.format(form.findField('date_till').getValue(),'d-m-Y');store_listPaidBilling.load();}});